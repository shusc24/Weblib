(function(factory){if(typeof window.define==='function'){if(window.define.amd){window.define('wangEditor',["jquery"],factory)}else if(window.define.cmd){window.define(function(require,exports,module){return factory})}else{factory(window.jQuery)}}else if(typeof module==="object"&&typeof module.exports==="object"){window.wangEditorCssPath?require(window.wangEditorCssPath):require('../css/wangEditor.css');module.exports=factory(window.wangEditorJQueryPath?require(window.wangEditorJQueryPath):require('jquery'))}else{factory(window.jQuery)}})(function($){if(!$||!$.fn||!$.fn.jquery){alert('在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor');return}var _e=function(fn){var E=window.wangEditor;if(E){fn(E,$)}};(function(window, $){if(window.wangEditor){alert('一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！');return}var E=function(elem){if(typeof elem==='string'){elem='#'+elem}var $elem=$(elem);if($elem.length!==1){return}var nodeName=$elem[0].nodeName;if(nodeName!=='TEXTAREA'&&nodeName!=='DIV'){return}this.valueNodeName=nodeName.toLowerCase();this.$valueContainer=$elem;this.$prev=$elem.prev();this.$parent=$elem.parent();this.init()};E.fn=E.prototype;E.$body=$('body');E.$document=$(document);E.$window=$(window);E.userAgent=navigator.userAgent;E.getComputedStyle=window.getComputedStyle;E.w3cRange=typeof document.createRange==='function';E.hostname=location.hostname.toLowerCase();E.websiteHost='wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me';E.isOnWebsite=E.websiteHost.indexOf(E.hostname)>=0;E.docsite='http://www.kancloud.cn/wangfupeng/wangeditor2/113961';window.wangEditor=E;E.plugin=function(fn){if(!E._plugins){E._plugins=[]}if(typeof fn==='function'){E._plugins.push(fn)}}})(window,$);_e(function(E,$){E.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}});_e(function(E,$){E.fn.ready=function(fn){if(!this.readyFns){this.readyFns=[]}this.readyFns.push(fn)};E.fn.readyHeadler=function(){var fns=this.readyFns;while(fns.length){fns.shift().call(this)}};E.fn.updateValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $txt=editor.txt.$txt;if($valueContainer===$txt){return}var value=$txt.html();$valueContainer.val(value)};E.fn.getInitValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var currentValue='';var nodeName=editor.valueNodeName;if(nodeName==='div'){currentValue=$valueContainer.html()}else if(nodeName==='textarea'){currentValue=$valueContainer.val()}return currentValue};E.fn.updateMenuStyle=function(){var menus=this.menus;$.each(menus,function(k,menu){menu.updateSelected()})};E.fn.enableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==='string'){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(false)})};E.fn.disableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==='string'){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(true)})};E.fn.hideDropPanelAndModal=function(){var menus=this.menus;$.each(menus,function(k,menu){var m=menu.dropPanel||menu.dropList||menu.modal;if(m&&m.hide){m.hide()}})}});_e(function(E,$){var ieRange=!E.w3cRange;function emptyFn(){}E.fn.currentRange=function(cr){if(cr){this._rangeData=cr}else{return this._rangeData}};E.fn.collapseRange=function(range,opt){opt=opt||'end';opt=opt==='start'?true:false;range=range||this.currentRange();if(range){range.collapse(opt);this.currentRange(range)}};E.fn.getRangeText=ieRange?emptyFn:function(range){range=range||this.currentRange();if(!range){return}return range.toString()};E.fn.getRangeElem=ieRange?emptyFn:function(range){range=range||this.currentRange();var dom=range.commonAncestorContainer;if(dom.nodeType===1){return dom}else{return dom.parentNode}};E.fn.isRangeEmpty=ieRange?emptyFn:function(range){range=range||this.currentRange();if(range&&range.startContainer){if(range.startContainer===range.endContainer){if(range.startOffset===range.endOffset){return true}}}return false};E.fn.saveSelection=ieRange?emptyFn:function(range){var self=this,_parentElem,selection,txt=self.txt.$txt.get(0);if(range){_parentElem=range.commonAncestorContainer}else{selection=document.getSelection();if(selection.getRangeAt&&selection.rangeCount){range=document.getSelection().getRangeAt(0);_parentElem=range.commonAncestorContainer}}if(_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)){self.currentRange(range)}};E.fn.restoreSelection=ieRange?emptyFn:function(range){var selection;range=range||this.currentRange();if(!range){return}try{selection=document.getSelection();selection.removeAllRanges();selection.addRange(range)}catch(ex){E.error('执行 editor.restoreSelection 时，IE可能会有异常，不影响使用')}};E.fn.restoreSelectionByElem=ieRange?emptyFn:function(elem,opt){if(!elem){return}opt=opt||'end';this.setRangeByElem(elem);if(opt==='start'){this.collapseRange(this.currentRange(),'start')}if(opt==='end'){this.collapseRange(this.currentRange(),'end')}this.restoreSelection()};E.fn.initSelection=ieRange?emptyFn:function(){var editor=this;if(editor.currentRange()){return}var range;var $txt=editor.txt.$txt;var $firstChild=$txt.children().first();if($firstChild.length){editor.restoreSelectionByElem($firstChild.get(0))}};E.fn.setRangeByElem=ieRange?emptyFn:function(elem){var editor=this;var txtElem=editor.txt.$txt.get(0);if(!elem||!$.contains(txtElem,elem)){return}var firstTextNode=elem.firstChild;while(firstTextNode){if(firstTextNode.nodeType===3){break}firstTextNode=firstTextNode.firstChild}var lastTextNode=elem.lastChild;while(lastTextNode){if(lastTextNode.nodeType===3){break}lastTextNode=lastTextNode.lastChild}var range=document.createRange();if(firstTextNode&&lastTextNode){range.setStart(firstTextNode,0);range.setEnd(lastTextNode,lastTextNode.textContent.length)}else{range.setStart(elem,0);range.setEnd(elem,0)}editor.saveSelection(range)}});_e(function(E,$){if(E.w3cRange){return}E.fn.getRangeText=function(range){range=range||this.currentRange();if(!range){return}return range.text};E.fn.getRangeElem=function(range){range=range||this.currentRange();if(!range){return}var dom=range.parentElement();if(dom.nodeType===1){return dom}else{return dom.parentNode}};E.fn.isRangeEmpty=function(range){range=range||this.currentRange();if(range&&range.text){return false}return true};E.fn.saveSelection=function(range){var self=this,_parentElem,selection,txt=self.txt.$txt.get(0);if(range){_parentElem=range.parentElement()}else{range=document.selection.createRange();if(typeof range.parentElement==='undefined'){_parentElem=null}else{_parentElem=range.parentElement()}}if(_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)){self.currentRange(range)}};E.fn.restoreSelection=function(currentRange){var editor=this,selection,range;currentRange=currentRange||editor.currentRange();if(!currentRange){return}range=document.selection.createRange();try{range.setEndPoint('EndToEnd',currentRange)}catch(ex){}if(currentRange.text.length===0){try{range.collapse(false)}catch(ex){}}else{range.setEndPoint('StartToStart',currentRange)}range.select()}});_e(function(E,$){E.fn.commandHooks=function(){var editor=this;var commandHooks={};commandHooks.insertHtml=function(html){var $elem=$(html);var rangeElem=editor.getRangeElem();var targetElem;targetElem=editor.getLegalTags(rangeElem);if(!targetElem){return}$(targetElem).after($elem)};editor.commandHooks=commandHooks}});_e(function(E,$){E.fn.command=function(e,commandName,commandValue,callback){var editor=this;var hooks;function commandFn(){if(!commandName){return}if(editor.queryCommandSupported(commandName)){document.execCommand(commandName,false,commandValue)}else{hooks=editor.commandHooks;if(commandName in hooks){hooks[commandName](commandValue)}}}this.customCommand(e,commandFn,callback)};E.fn.commandForElem=function(elemOpt,e,commandName,commandValue,callback){var selector;var check;if(typeof elemOpt==='string'){selector=elemOpt}else{selector=elemOpt.selector;check=elemOpt.check}var rangeElem=this.getRangeElem();rangeElem=this.getSelfOrParentByName(rangeElem,selector,check);if(rangeElem){this.setRangeByElem(rangeElem)}this.command(e,commandName,commandValue,callback)};E.fn.customCommand=function(e,commandFn,callback){var editor=this;var range=editor.currentRange();if(!range){e&&e.preventDefault();return}editor.undoRecord();this.restoreSelection(range);commandFn.call(editor);this.saveSelection();this.restoreSelection();if(callback&&typeof callback==='function'){callback.call(editor)}editor.txt.insertEmptyP();editor.txt.wrapImgAndText();editor.updateValue();editor.updateMenuStyle();function hidePanelAndModal(){editor.hideDropPanelAndModal()}setTimeout(hidePanelAndModal,200);if(e){e.preventDefault()}};E.fn.queryCommandValue=function(commandName){var result='';try{result=document.queryCommandValue(commandName)}catch(ex){}return result};E.fn.queryCommandState=function(commandName){var result=false;try{result=document.queryCommandState(commandName)}catch(ex){}return result};E.fn.queryCommandSupported=function(commandName){var result=false;try{result=document.queryCommandSupported(commandName)}catch(ex){}return result}});_e(function(E,$){var matchesSelector;function _matchesSelectorForIE(selector){var elem=this;var $elems=$(selector);var result=false;$elems.each(function(){if(this===elem){result=true;return false}});return result}E.fn.getLegalTags=function(elem){var legalTags=this.config.legalTags;if(!legalTags){E.error('配置项中缺少 legalTags 的配置');return}return this.getSelfOrParentByName(elem,legalTags)};E.fn.getSelfOrParentByName=function(elem,selector,check){if(!elem||!selector){return}if(!matchesSelector){matchesSelector=elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.oMatchesSelector||elem.matchesSelector}if(!matchesSelector){matchesSelector=_matchesSelectorForIE}var txt=this.txt.$txt.get(0);while(elem&&txt!==elem&&$.contains(txt,elem)){if(matchesSelector.call(elem,selector)){if(!check){return elem}if(check(elem)){return elem}}elem=elem.parentNode}return}});_e(function(E,$){var length=20;function _getRedoList(editor){if(editor._redoList==null){editor._redoList=[]}return editor._redoList}function _getUndoList(editor){if(editor._undoList==null){editor._undoList=[]}return editor._undoList}function _handle(editor,data,type){var val=data.val;var html=editor.txt.$txt.html();if(val==null){return}if(val===html){if(type==='redo'){editor.redo();return}else if(type==='undo'){editor.undo();return}else{return}}editor.txt.$txt.html(val);editor.updateValue();if(editor.onchange&&typeof editor.onchange==='function'){editor.onchange.call(editor)}}E.fn.undoRecord=function(){var editor=this;var $txt=editor.txt.$txt;var val=$txt.html();var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);var currentVal=undoList.length?undoList[0]:'';if(val===currentVal.val){return}if(redoList.length){redoList=[]}undoList.unshift({range:editor.currentRange(),val:val});if(undoList.length>length){undoList.pop()}};E.fn.undo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!undoList.length){return}var data=undoList.shift();redoList.unshift(data);_handle(this,data,'undo')};E.fn.redo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!redoList.length){return}var data=redoList.shift();undoList.unshift(data);_handle(this,data,'redo')}});_e(function(E,$){E.fn.create=function(){var editor=this;if(!E.$body||E.$body.length===0){E.$body=$('body');E.$document=$(document);E.$window=$(window)}editor.addMenus();editor.renderMenus();editor.renderMenuContainer();editor.renderTxt();editor.renderEditorContainer();editor.eventMenus();editor.eventMenuContainer();editor.eventTxt();editor.readyHeadler();editor.initSelection();editor.$txt=editor.txt.$txt;var _plugins=E._plugins;if(_plugins&&_plugins.length){$.each(_plugins,function(k,val){val.call(editor)})}};E.fn.disable=function(){this.txt.$txt.removeAttr('contenteditable');this.disableMenusExcept();this._disabled=true};E.fn.enable=function(){this._disabled=false;this.txt.$txt.attr('contenteditable','true');this.enableMenusExcept()};E.fn.destroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==='div'){$valueContainer.removeAttr('contenteditable');$editorContainer.after($valueContainer);$editorContainer.hide()}else{$valueContainer.show();$editorContainer.hide()}};E.fn.undestroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var $menuContainer=self.menuContainer.$menuContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==='div'){$valueContainer.attr('contenteditable','true');$menuContainer.after($valueContainer);$editorContainer.show()}else{$valueContainer.hide();$editorContainer.show()}};E.fn.clear=function(){var editor=this;var $txt=editor.txt.$txt;$txt.html('<p><br></p>');editor.restoreSelectionByElem($txt.find('p').get(0))}});_e(function(E,$){var MenuContainer=function(editor){this.editor=editor;this.init()};MenuContainer.fn=MenuContainer.prototype;E.MenuContainer=MenuContainer});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.init=function(){var self=this;var $menuContainer=$('<div class="wangEditor-menu-container clearfix"></div>');self.$menuContainer=$menuContainer;self.changeShadow()};MenuContainer.fn.changeShadow=function(){var $menuContainer=this.$menuContainer;var editor=this.editor;var $txt=editor.txt.$txt;$txt.on('scroll',function(){if($txt.scrollTop()>10){$menuContainer.addClass('wangEditor-menu-shadow')}else{$menuContainer.removeClass('wangEditor-menu-shadow')}})}});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.render=function(){var $menuContainer=this.$menuContainer;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($menuContainer)};MenuContainer.fn.height=function(){var $menuContainer=this.$menuContainer;return $menuContainer.height()};MenuContainer.fn.appendMenu=function(groupIdx,menu){this._addGroup(groupIdx);return this._addOneMenu(menu)};MenuContainer.fn._addGroup=function(groupIdx){var $menuContainer=this.$menuContainer;var $menuGroup;if(!this.$currentGroup||this.currentGroupIdx!==groupIdx){$menuGroup=$('<div class="menu-group clearfix"></div>');$menuContainer.append($menuGroup);this.$currentGroup=$menuGroup;this.currentGroupIdx=groupIdx}};MenuContainer.fn._addOneMenu=function(menu){var $menuNormal=menu.$domNormal;var $menuSelected=menu.$domSelected;var $menuGroup=this.$currentGroup;var $item=$('<div class="menu-item clearfix"></div>');$menuSelected.hide();$item.append($menuNormal).append($menuSelected);$menuGroup.append($item);return $item}});_e(function(E,$){var Menu=function(opt){this.editor=opt.editor;this.id=opt.id;this.title=opt.title;this.$domNormal=opt.$domNormal;this.$domSelected=opt.$domSelected||opt.$domNormal;this.commandName=opt.commandName;this.commandValue=opt.commandValue;this.commandNameSelected=opt.commandNameSelected||opt.commandName;this.commandValueSelected=opt.commandValueSelected||opt.commandValue};Menu.fn=Menu.prototype;E.Menu=Menu});_e(function(E,$){var Menu=E.Menu;Menu.fn.initUI=function(){var editor=this.editor;var uiConfig=editor.UI.menus;var menuId=this.id;var menuUI=uiConfig[menuId];if(this.$domNormal&&this.$domSelected){return}if(menuUI==null){E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值');menuUI=uiConfig['default']}this.$domNormal=$(menuUI.normal);if(/^\./.test(menuUI.selected)){this.$domSelected=this.$domNormal.clone().addClass(menuUI.selected.slice(1))}else{this.$domSelected=$(menuUI.selected)}}});_e(function(E,$){var Menu=E.Menu;Menu.fn.render=function(groupIdx){this.initUI();var editor=this.editor;var menuContainer=editor.menuContainer;var $menuItem=menuContainer.appendMenu(groupIdx,this);var onRender=this.onRender;this._renderTip($menuItem);if(onRender&&typeof onRender==='function'){onRender.call(this)}};Menu.fn._renderTip=function($menuItem){var self=this;var editor=self.editor;var title=self.title;var $tip=$('<div class="menu-tip"></div>');var $tempDiv;if(!self.tipWidth){$tempDiv=$('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+title+'</p>');E.$body.append($tempDiv);editor.ready(function(){var editor=this;var titleWidth=$tempDiv.outerWidth()+5;var currentWidth=$tip.outerWidth();var currentMarginLeft=parseFloat($tip.css('margin-left'),10);$tempDiv.remove();$tempDiv=null;$tip.css({width:titleWidth,'margin-left':currentMarginLeft+(currentWidth-titleWidth)/2});self.tipWidth=titleWidth})}$tip.append(title);$menuItem.append($tip);function show(){$tip.show()}function hide(){$tip.hide()}var timeoutId;$menuItem.find('a').on('mouseenter',function(e){if(!self.active()&&!self.disabled()){timeoutId=setTimeout(show,200)}}).on('mouseleave',function(e){timeoutId&&clearTimeout(timeoutId);hide()}).on('click',hide)};Menu.fn.bindEvent=function(){var self=this;var $domNormal=self.$domNormal;var $domSelected=self.$domSelected;var clickEvent=self.clickEvent;if(!clickEvent){clickEvent=function(e){var dropObj=self.dropPanel||self.dropList||self.modal;if(dropObj&&dropObj.show){if(dropObj.isShowing){dropObj.hide()}else{dropObj.show()}return}var editor=self.editor;var commandName;var commandValue;var selected=self.selected;if(selected){commandName=self.commandNameSelected;commandValue=self.commandValueSelected}else{commandName=self.commandName;commandValue=self.commandValue}if(commandName){editor.command(e,commandName,commandValue)}else{E.warn('菜单 "'+self.id+'" 未定义click事件');e.preventDefault()}}}var clickEventSelected=self.clickEventSelected||clickEvent;$domNormal.click(function(e){if(!self.disabled()){clickEvent.call(self,e);self.updateSelected()}e.preventDefault()});$domSelected.click(function(e){if(!self.disabled()){clickEventSelected.call(self,e);self.updateSelected()}e.preventDefault()})};Menu.fn.updateSelected=function(){var self=this;var editor=self.editor;var updateSelectedEvent=self.updateSelectedEvent;if(!updateSelectedEvent){updateSelectedEvent=function(){var self=this;var editor=self.editor;var commandName=self.commandName;var commandValue=self.commandValue;if(commandValue){if(editor.queryCommandValue(commandName).toLowerCase()===commandValue.toLowerCase()){return true}}else if(editor.queryCommandState(commandName)){return true}return false}}var result=updateSelectedEvent.call(self);result=!!result;self.changeSelectedState(result)};Menu.fn.changeSelectedState=function(state){var self=this;var selected=self.selected;if(state!=null&&typeof state==='boolean'){if(selected===state){return}self.selected=state;if(state){self.$domNormal.hide();self.$domSelected.show()}else{self.$domNormal.show();self.$domSelected.hide()}}};Menu.fn.active=function(active){if(active==null){return this._activeState}this._activeState=active};Menu.fn.activeStyle=function(active){var selected=this.selected;var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(active){$dom.addClass('active');$domSelected.addClass('active')}else{$dom.removeClass('active');$domSelected.removeClass('active')}this.active(active)};Menu.fn.disabled=function(opt){if(opt==null){return!!this._disabled}if(this._disabled===opt){return}var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(opt){$dom.addClass('disable');$domSelected.addClass('disable')}else{$dom.removeClass('disable');$domSelected.removeClass('disable')}this._disabled=opt}});_e(function(E,$){var DropList=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.data=opt.data;this.tpl=opt.tpl;this.selectorForELemCommand=opt.selectorForELemCommand;this.beforeEvent=opt.beforeEvent;this.afterEvent=opt.afterEvent;this.init()};DropList.fn=DropList.prototype;E.DropList=DropList});_e(function(E,$){var DropList=E.DropList;DropList.fn.init=function(){var self=this;self.initDOM();self.bindEvent();self.initHideEvent()};DropList.fn.initDOM=function(){var self=this;var data=self.data;var tpl=self.tpl||'<span>{#title}</span>';var $list=$('<div class="wangEditor-drop-list clearfix"></div>');var itemContent;var $item;$.each(data,function(commandValue,title){itemContent=tpl.replace(/{#commandValue}/ig,commandValue).replace(/{#title}/ig,title);$item=$('<a href="#" commandValue="'+commandValue+'"></a>');$item.append(itemContent);$list.append($item)});self.$list=$list};DropList.fn.bindEvent=function(){var self=this;var editor=self.editor;var menu=self.menu;var commandName=menu.commandName;var selectorForELemCommand=self.selectorForELemCommand;var $list=self.$list;var beforeEvent=self.beforeEvent;var afterEvent=self.afterEvent;$list.on('click','a[commandValue]',function(e){if(beforeEvent&&typeof beforeEvent==='function'){beforeEvent.call(e)}var commandValue=$(e.currentTarget).attr('commandValue');if(menu.selected&&editor.isRangeEmpty()&&selectorForELemCommand){editor.commandForElem(selectorForELemCommand,e,commandName,commandValue)}else{editor.command(e,commandName,commandValue)}if(afterEvent&&typeof afterEvent==='function'){afterEvent.call(e)}})};DropList.fn.initHideEvent=function(){var self=this;var thisList=self.$list.get(0);E.$body.on('click',function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisList===trigger||$.contains(thisList,trigger)){return}self.hide()});E.$window.scroll(function(){self.hide()});E.$window.on('resize',function(){self.hide()})}});_e(function(E,$){var DropList=E.DropList;DropList.fn._render=function(){var self=this;var editor=self.editor;var $list=self.$list;editor.$editorContainer.append($list);self.rendered=true};DropList.fn._position=function(){var self=this;var $list=self.$list;var editor=self.editor;var menu=self.menu;var $menuContainer=editor.menuContainer.$menuContainer;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition=$menuDom.offsetParent().position();var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var listWidth=$list.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-menuWidth/2;var valWithTxt=(left+listWidth)-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$list.css({top:top,left:left,'margin-left':marginLeft});if(editor._isMenufixed){top=top+(($menuContainer.offset().top+$menuContainer.outerHeight())-$list.offset().top);$list.css({top:top})}};DropList.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $list=self.$list;$list.show();self._position();self.isShowing=true;menu.activeStyle(true)};DropList.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $list=self.$list;$list.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var DropPanel=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.$content=opt.$content;this.width=opt.width||200;this.height=opt.height;this.onRender=opt.onRender;this.init()};DropPanel.fn=DropPanel.prototype;E.DropPanel=DropPanel});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn.init=function(){var self=this;self.initDOM();self.initHideEvent()};DropPanel.fn.initDOM=function(){var self=this;var $content=self.$content;var width=self.width;var height=self.height;var $panel=$('<div class="wangEditor-drop-panel clearfix"></div>');var $triangle=$('<div class="tip-triangle"></div>');$panel.css({width:width,height:height?height:'auto'});$panel.append($triangle);$panel.append($content);self.$panel=$panel;self.$triangle=$triangle};DropPanel.fn.initHideEvent=function(){var self=this;var thisPanle=self.$panel.get(0);E.$body.on('click',function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisPanle===trigger||$.contains(thisPanle,trigger)){return}self.hide()});E.$window.scroll(function(e){self.hide()});E.$window.on('resize',function(){self.hide()})}});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn._render=function(){var self=this;var onRender=self.onRender;var editor=self.editor;var $panel=self.$panel;editor.$editorContainer.append($panel);onRender&&onRender.call(self);self.rendered=true};DropPanel.fn._position=function(){var self=this;var $panel=self.$panel;var $triangle=self.$triangle;var editor=self.editor;var $menuContainer=editor.menuContainer.$menuContainer;var menu=self.menu;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition=$menuDom.offsetParent().position();var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var panelWidth=$panel.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-panelWidth/2;var marginLeft2=marginLeft;if((0-marginLeft)>(left-10)){marginLeft=0-(left-10)}var valWithTxt=(left+panelWidth+marginLeft)-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$panel.css({top:top,left:left,'margin-left':marginLeft});if(editor._isMenufixed){top=top+(($menuContainer.offset().top+$menuContainer.outerHeight())-$panel.offset().top);$panel.css({top:top})}$triangle.css({'margin-left':marginLeft2-marginLeft-5})};DropPanel.fn.focusFirstInput=function(){var self=this;var $panel=self.$panel;$panel.find('input[type=text],textarea').each(function(){var $input=$(this);if($input.attr('disabled')==null){$input.focus();return false}})};DropPanel.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $panel=self.$panel;$panel.show();self._position();self.isShowing=true;menu.activeStyle(true);if(E.w3cRange){self.focusFirstInput()}else{E.placeholderForIE8($panel)}};DropPanel.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $panel=self.$panel;$panel.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var Modal=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.$content=opt.$content;this.init()};Modal.fn=Modal.prototype;E.Modal=Modal});_e(function(E,$){var Modal=E.Modal;Modal.fn.init=function(){var self=this;self.initDom();self.initHideEvent()};Modal.fn.initDom=function(){var self=this;var $content=self.$content;var $modal=$('<div class="wangEditor-modal"></div>');var $close=$('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');$modal.append($close);$modal.append($content);self.$modal=$modal;self.$close=$close};Modal.fn.initHideEvent=function(){var self=this;var $close=self.$close;var modal=self.$modal.get(0);$close.click(function(){self.hide()});E.$body.on('click',function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu){if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}}if(modal===trigger||$.contains(modal,trigger)){return}self.hide()})}});_e(function(E,$){var Modal=E.Modal;Modal.fn._render=function(){var self=this;var editor=self.editor;var $modal=self.$modal;$modal.css('z-index',editor.config.zindex+10+'');E.$body.append($modal);self.rendered=true};Modal.fn._position=function(){var self=this;var $modal=self.$modal;var top=$modal.offset().top;var width=$modal.outerWidth();var height=$modal.outerHeight();var marginLeft=0-(width/2);var marginTop=0-(height/2);var sTop=E.$window.scrollTop();if((height/2)>top){marginTop=0-top}$modal.css({'margin-left':marginLeft+'px','margin-top':(marginTop+sTop)+'px'})};Modal.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}self.isShowing=true;var $modal=self.$modal;$modal.show();self._position();menu&&menu.activeStyle(true)};Modal.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}self.isShowing=false;var $modal=self.$modal;$modal.hide();menu&&menu.activeStyle(false)}});_e(function(E,$){var Txt=function(editor){this.editor=editor;this.init()};Txt.fn=Txt.prototype;E.Txt=Txt});_e(function(E,$){var Txt=E.Txt;Txt.fn.init=function(){var self=this;var editor=self.editor;var $valueContainer=editor.$valueContainer;var currentValue=editor.getInitValue();var $txt;if($valueContainer.get(0).nodeName==='DIV'){$txt=$valueContainer;$txt.addClass("wangEditor-txt");$txt.attr('contentEditable','true')}else{$txt=$('<div class="wangEditor-txt" contentEditable="true">'+currentValue+'</div>')}editor.ready(function(){self.insertEmptyP()});self.$txt=$txt;self.contentEmptyHandle();self.bindEnterForDiv();self.bindEnterForText();self.bindTabEvent();self.bindPasteFilter();self.bindFormatText();self.bindHtml()};Txt.fn.contentEmptyHandle=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $p;$txt.on('keydown',function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(txtHtml==='<p><br></p>'){e.preventDefault();return}});$txt.on('keyup',function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(!txtHtml||txtHtml==='<br>'){$p=$('<p><br/></p>');$txt.html('');$txt.append($p);editor.restoreSelectionByElem($p.get(0))}})};Txt.fn.bindEnterForDiv=function(){var tags=E.config.legalTags;var self=this;var editor=self.editor;var $txt=self.$txt;var $keydownDivElem;function divHandler(){if(!$keydownDivElem){return}var $pElem=$('<p>'+$keydownDivElem.html()+'</p>');$keydownDivElem.after($pElem);$keydownDivElem.remove()}$txt.on('keydown keyup',function(e){if(e.keyCode!==13){return}var rangeElem=editor.getRangeElem();var targetElem=editor.getLegalTags(rangeElem);var $targetElem;var $pElem;if(!targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,'div');if(!targetElem){return}$targetElem=$(targetElem);if(e.type==='keydown'){$keydownDivElem=$targetElem;setTimeout(divHandler,0)}if(e.type==='keyup'){$pElem=$('<p>'+$targetElem.html()+'</p>');$targetElem.after($pElem);$targetElem.remove();editor.restoreSelectionByElem($pElem.get(0),'start')}}})};Txt.fn.bindEnterForText=function(){var self=this;var $txt=self.$txt;var handle;$txt.on('keyup',function(e){if(e.keyCode!==13){return}if(!handle){handle=function(){self.wrapImgAndText()}}setTimeout(handle)})};Txt.fn.bindTabEvent=function(){var self=this;var editor=self.editor;var $txt=self.$txt;$txt.on('keydown',function(e){if(e.keyCode!==9){return}if(editor.queryCommandSupported('insertHtml')){editor.command(e,'insertHtml','&nbsp;&nbsp;&nbsp;&nbsp;')}})};Txt.fn.bindPasteFilter=function(){var self=this;var editor=self.editor;var resultHtml='';var $txt=self.$txt;var legalTags=editor.config.legalTags;var legalTagArr=legalTags.split(',');$txt.on('paste',function(e){if(!editor.config.pasteFilter){return}var currentNodeName=editor.getRangeElem().nodeName;if(currentNodeName==='TD'||currentNodeName==='TH'){return}resultHtml='';var pasteHtml,$paste;var data=e.clipboardData||e.originalEvent.clipboardData;var ieData=window.clipboardData;if(editor.config.pasteText){if(data&&data.getData){pasteHtml=data.getData('text/plain')}else if(ieData&&ieData.getData){pasteHtml=ieData.getData('text')}else{return}if(pasteHtml){resultHtml='<p>'+pasteHtml+'</p>'}}else{if(data&&data.getData){pasteHtml=data.getData('text/html');if(pasteHtml){$paste=$('<div>'+pasteHtml+'</div>');handle($paste.get(0))}else{pasteHtml=data.getData('text/plain');if(pasteHtml){pasteHtml=pasteHtml.replace(/[ ]/g,'&nbsp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'</p><p>');resultHtml='<p>'+pasteHtml+'</p>';resultHtml=resultHtml.replace(/<p>(https?:\/\/.*?)<\/p>/ig,function(match,link){return '<p><a href="'+link+'" target="_blank">'+link+'</p>'})}}}else if(ieData&&ieData.getData){resultHtml=ieData.getData('text');if(!resultHtml){return}resultHtml='<p>'+resultHtml+'</p>';resultHtml=resultHtml.replace(new RegExp('\n','g'),'</p><p>')}else{return}}if(resultHtml){editor.command(e,'insertHtml',resultHtml);self.clearEmptyOrNestP()}});function handle(elem){if(!elem||!elem.nodeType||!elem.nodeName){return}var $elem;var nodeName=elem.nodeName.toLowerCase();var nodeType=elem.nodeType;var childNodesClone;if(nodeType!==3&&nodeType!==1){return}$elem=$(elem);if(nodeName==='div'){childNodesClone=[];$.each(elem.childNodes,function(index,item){childNodesClone.push(item)});$.each(childNodesClone,function(){handle(this)});return}if(legalTagArr.indexOf(nodeName)>=0){resultHtml+=getResult(elem)}else if(nodeType===3){resultHtml+='<p>'+elem.textContent+'</p>'}else if(nodeName==='br'){resultHtml+='<br/>'}else{if(['meta','style','script','object','form','iframe','hr'].indexOf(nodeName)>=0){return}$elem=$(removeAttrs(elem));resultHtml+=$('<div>').append($elem.clone()).html()}}function getResult(elem){var nodeName=elem.nodeName.toLowerCase();var $elem;var htmlForP='';var htmlForLi='';if(['blockquote'].indexOf(nodeName)>=0){$elem=$(elem);return '<'+nodeName+'>'+$elem.text()+'</'+nodeName+'>'}else if(['p','h1','h2','h3','h4','h5'].indexOf(nodeName)>=0){elem=removeAttrs(elem);$elem=$(elem);htmlForP=$elem.html();htmlForP=htmlForP.replace(/<.*?>/ig,function(tag){if(tag==='</a>'||tag.indexOf('<a ')===0||tag.indexOf('<img ')===0){return tag}else{return ''}});return '<'+nodeName+'>'+htmlForP+'</'+nodeName+'>'}else if(['ul','ol'].indexOf(nodeName)>=0){$elem=$(elem);$elem.children().each(function(){var $li=$(removeAttrs(this));var html=$li.html();html=html.replace(/<.*?>/ig,function(tag){if(tag==='</a>'||tag.indexOf('<a ')===0||tag.indexOf('<img ')===0){return tag}else{return ''}});htmlForLi+='<li>'+html+'</li>'});return '<'+nodeName+'>'+htmlForLi+'</'+nodeName+'>'}else{$elem=$(removeAttrs(elem));return $('<div>').append($elem).html()}}function removeAttrs(elem){var attrs=elem.attributes||[];var attrNames=[];var exception=['href','target','src','alt','rowspan','colspan'];$.each(attrs,function(key,attr){if(attr&&attr.nodeType===2){attrNames.push(attr.nodeName)}});$.each(attrNames,function(key,attr){if(exception.indexOf(attr)<0){elem.removeAttribute(attr)}});var children=elem.childNodes;if(children.length){$.each(children,function(key,value){removeAttrs(value)})}return elem}};Txt.fn.bindFormatText=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var legalTags=E.config.legalTags;var legalTagArr=legalTags.split(',');var length=legalTagArr.length;var regArr=[];$.each(legalTagArr,function(k,tag){var reg='\>\\s*\<('+tag+')\>';regArr.push(new RegExp(reg,'ig'))});regArr.push(new RegExp('\>\\s*\<(li)\>','ig'));regArr.push(new RegExp('\>\\s*\<(tr)\>','ig'));regArr.push(new RegExp('\>\\s*\<(code)\>','ig'));$txt.formatText=function(){var $temp=$('<div>');var html=$txt.html();html=html.replace(/\s*</ig,'<');$.each(regArr,function(k,reg){if(!reg.test(html)){return}html=html.replace(reg,function(matchStr,tag){return '>\n<'+tag+'>'})});$temp.html(html);return $temp.text()}};Txt.fn.bindHtml=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $valueContainer=editor.$valueContainer;var valueNodeName=editor.valueNodeName;$txt.html=function(html){var result;if(valueNodeName==='div'){result=$.fn.html.call($txt,html)}if(html===undefined){result=$.fn.html.call($txt);result=result.replace(/(href|src)\=\"(.*)\"/igm,function(a,b,c){return b+'="'+c.replace('&amp;','&')+'"'})}else{result=$.fn.html.call($txt,html);$valueContainer.val(html)}if(html===undefined){return result}else{$txt.change()}}}});_e(function(E,$){var Txt=E.Txt;var txtChangeEventNames='propertychange change click keyup input paste';Txt.fn.render=function(){var $txt=this.$txt;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($txt)};Txt.fn.initHeight=function(){var editor=this.editor;var $txt=this.$txt;var valueContainerHeight=editor.$valueContainer.height();var menuHeight=editor.menuContainer.height();var txtHeight=valueContainerHeight-menuHeight;txtHeight=txtHeight<50?50:txtHeight;$txt.height(txtHeight);editor.valueContainerHeight=valueContainerHeight;this.initMaxHeight(txtHeight,menuHeight)};Txt.fn.initMaxHeight=function(txtHeight,menuHeight){var editor=this.editor;var $menuContainer=editor.menuContainer.$menuContainer;var $txt=this.$txt;var $wrap=$('<div>');if(window.getComputedStyle&&'max-height'in window.getComputedStyle($txt.get(0))){var maxHeight=parseInt(editor.$valueContainer.css('max-height'));if(isNaN(maxHeight)){return}if(editor.menus.fullscreen){E.warn('max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用');return}editor.useMaxHeight=true;$wrap.css({'max-height':(maxHeight-menuHeight)+'px','overflow-y':'auto'});$txt.css({'height':'auto','overflow-y':'visible','min-height':txtHeight+'px'});$wrap.on('scroll',function(){if($txt.parent().scrollTop()>10){$menuContainer.addClass('wangEditor-menu-shadow')}else{$menuContainer.removeClass('wangEditor-menu-shadow')}});$txt.wrap($wrap)}};Txt.fn.saveSelectionEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId;var dt=Date.now();function save(){editor.saveSelection()}function saveSync(){if(Date.now()-dt<100){return}dt=Date.now();save()}function saveAync(){if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(save,300)}$txt.on(txtChangeEventNames+' focus blur',function(e){saveSync();saveAync()});$txt.on('mousedown',function(){$txt.on('mouseleave.saveSelection',function(e){saveSync();saveAync();editor.updateMenuStyle()})}).on('mouseup',function(){$txt.off('mouseleave.saveSelection')})};Txt.fn.updateValueEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId,oldValue;function doOnchange(){var val=$txt.html();if(oldValue===val){return}if(editor.onchange&&typeof editor.onchange==='function'){editor.onchange.call(editor)}editor.updateValue();oldValue=val}$txt.on(txtChangeEventNames,function(e){if(oldValue==null){oldValue=$txt.html()}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(doOnchange,100)})};Txt.fn.updateMenuStyleEvent=function(){var $txt=this.$txt;var editor=this.editor;$txt.on(txtChangeEventNames,function(e){editor.updateMenuStyle()})};Txt.fn.insertEmptyP=function(){var $txt=this.$txt;var $children=$txt.children();if($children.length===0){$txt.append($('<p><br></p>'));return}if($.trim($children.last().html()).toLowerCase()!=='<br>'){$txt.append($('<p><br></p>'))}};Txt.fn.wrapImgAndText=function(){var $txt=this.$txt;var $imgs=$txt.children('img');var txt=$txt[0];var childNodes=txt.childNodes;var childrenLength=childNodes.length;var i,childNode,p;$imgs.length&&$imgs.each(function(){$(this).wrap('<p>')});for(i=0;i<childrenLength;i+=1){childNode=childNodes[i];if(childNode.nodeType===3&&childNode.textContent&&$.trim(childNode.textContent)){$(childNode).wrap('<p>')}}};Txt.fn.clearEmptyOrNestP=function(){var $txt=this.$txt;var $pList=$txt.find('p');$pList.each(function(){var $p=$(this);var $children=$p.children();var childrenLength=$children.length;var $firstChild;var content=$.trim($p.html());if(!content){$p.remove();return}if(childrenLength===1){$firstChild=$children.first();if($firstChild.get(0)&&$firstChild.get(0).nodeName==='P'){$p.html($firstChild.html())}}})};Txt.fn.scrollTop=function(val){var self=this;var editor=self.editor;var $txt=self.$txt;if(editor.useMaxHeight){return $txt.parent().scrollTop(val)}else{return $txt.scrollTop(val)}};Txt.fn.showHeightOnHover=function(){var editor=this.editor;var $editorContainer=editor.$editorContainer;var menuContainer=editor.menuContainer;var $txt=this.$txt;var $tip=$('<i class="height-tip"><i>');var isTipInTxt=false;function addAndShowTip($target){if(!isTipInTxt){$editorContainer.append($tip);isTipInTxt=true}var txtTop=$txt.position().top;var txtHeight=$txt.outerHeight();var height=$target.height();var top=$target.position().top;var marginTop=parseInt($target.css('margin-top'),10);var paddingTop=parseInt($target.css('padding-top'),10);var marginBottom=parseInt($target.css('margin-bottom'),10);var paddingBottom=parseInt($target.css('padding-bottom'),10);var resultHeight=height+paddingTop+marginTop+paddingBottom+marginBottom;var resultTop=top+menuContainer.height();$tip.css({height:height+paddingTop+marginTop+paddingBottom+marginBottom,top:top+menuContainer.height()})}function removeTip(){if(!isTipInTxt){return}$tip.remove();isTipInTxt=false}$txt.on('mouseenter','ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre',function(e){addAndShowTip($(e.currentTarget))}).on('mouseleave',function(){removeTip()})}});_e(function(E,$){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elem){var i=0,length=this.length;for(;i<length;i+=1){if(this[i]===elem){return i}}return -1};Array.prototype.lastIndexOf=function(elem){var length=this.length;for(length=length-1;length>=0;length-=1){if(this[length]===elem){return length}}return -1}}if(!Date.now){Date.now=function(){return new Date().valueOf()}}var console=window.console;var emptyFn=function(){};$.each(['info','log','warn','error'],function(key,value){if(console==null){E[value]=emptyFn}else{E[value]=function(info){if(E.config&&E.config.printLog){console[value]('wangEditor提示: '+info)}}}});E.random=function(){return Math.random().toString().slice(2)};E.placeholder='placeholder'in document.createElement('input');E.placeholderForIE8=function($container){if(E.placeholder){return}$container.find('input[placeholder]').each(function(){var $input=$(this);var placeholder=$input.attr('placeholder');if($input.val()===''){$input.css('color','#666');$input.val(placeholder);$input.on('focus.placeholder click.placeholder',function(){$input.val('');$input.css('color','#333');$input.off('focus.placeholder click.placeholder')})}})}});_e(function(E,$){E.langs={};E.langs['zh-cn']={bold:'粗体',underline:'下划线',italic:'斜体',forecolor:'文字颜色',bgcolor:'背景色',strikethrough:'删除线',eraser:'清空格式',source:'源码',quote:'引用',fontfamily:'字体',fontsize:'字号',head:'标题',orderlist:'有序列表',unorderlist:'无序列表',alignleft:'左对齐',aligncenter:'居中',alignright:'右对齐',link:'链接',text:'文本',submit:'提交',cancel:'取消',unlink:'取消链接',table:'表格',emotion:'表情',img:'图片',video:'视频','width':'宽','height':'高',location:'位置',loading:'加载中',searchlocation:'搜索位置',dynamicMap:'动态地图',clearLocation:'清除位置',langDynamicOneLocation:'动态地图只能显示一个位置',insertcode:'插入代码',undo:'撤销',redo:'重复',fullscreen:'全屏',openLink:'打开链接'};E.langs.en={bold:'Bold',underline:'Underline',italic:'Italic',forecolor:'Color',bgcolor:'Backcolor',strikethrough:'Strikethrough',eraser:'Eraser',source:'Codeview',quote:'Quote',fontfamily:'Font family',fontsize:'Font size',head:'Head',orderlist:'Ordered list',unorderlist:'Unordered list',alignleft:'Align left',aligncenter:'Align center',alignright:'Align right',link:'Insert link',text:'Text',submit:'Submit',cancel:'Cancel',unlink:'Unlink',table:'Table',emotion:'Emotions',img:'Image',video:'Video','width':'width','height':'height',location:'Location',loading:'Loading',searchlocation:'search',dynamicMap:'Dynamic',clearLocation:'Clear',langDynamicOneLocation:'Only one location in dynamic map',insertcode:'Insert Code',undo:'Undo',redo:'Redo',fullscreen:'Full screnn',openLink:'open link'}});_e(function(E,$){E.config={};E.config.zindex=10000;E.config.printLog=true;E.config.menuFixed=0;E.config.jsFilter=true;E.config.legalTags='p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre';E.config.lang=E.langs['zh-cn'];E.config.menus=['source','|','bold','underline','italic','strikethrough','eraser','forecolor','bgcolor','|','quote','fontfamily','fontsize','head','unorderlist','orderlist','alignleft','aligncenter','alignright','|','link','unlink','table','emotion','|','img','video','location','insertcode','|','undo','redo','fullscreen'];E.config.colors={'#880000':'暗红色','#800080':'紫色','#ff0000':'红色','#ff00ff':'鲜粉色','#000080':'深蓝色','#0000ff':'蓝色','#00ffff':'湖蓝色','#008080':'蓝绿色','#008000':'绿色','#808000':'橄榄色','#00ff00':'浅绿色','#ffcc00':'橙黄色','#808080':'灰色','#c0c0c0':'银色','#000000':'黑色','#ffffff':'白色'};E.config.familys=['宋体','黑体','楷体','微软雅黑','Arial','Verdana','Georgia','Times New Roman','Microsoft JhengHei','Trebuchet MS','Courier New','Impact','Comic Sans MS','Consolas'];E.config.fontsizes={1:'12px',2:'13px',3:'16px',4:'18px',5:'24px',6:'32px',7:'48px'};E.config.emotionsShow='icon';E.config.emotions={'weibo':{title:'微博表情',data:[{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif',value:'[草泥马]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif',value:'[神马]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif',value:'[浮云]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif',value:'[给力]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif',value:'[围观]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif',value:'[威武]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif',value:'[熊猫]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif',value:'[兔子]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif',value:'[奥特曼]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif',value:'[囧]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif',value:'[互粉]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif',value:'[礼物]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif',value:'[呵呵]'},{icon:'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif',value:'[哈哈]'}]}};E.config.mapAk='TVhjYjq1ICT2qqL5LdS8mwas';E.config.uploadImgUrl='';E.config.uploadTimeout=20*1000;E.config.uploadImgFns={};E.config.customUpload=false;E.config.uploadParams={};E.config.uploadHeaders={};E.config.hideLinkImg=false;E.config.pasteFilter=true;E.config.pasteText=false;E.config.codeDefaultLang='javascript'});_e(function(E,$){E.UI={};E.UI.menus={'default':{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:'.selected'},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:'.selected'},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:'.selected'},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:'.selected'},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:'.selected'},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:'.selected'},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:'.selected'},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:'.selected'},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:'.selected'},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:'.selected'},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:'.selected'},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:'.selected'},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:'.selected'},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:'.selected'},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:'.selected'},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:'.selected'},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:'.selected'},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:'.selected'},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:'.selected'},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:'.selected'},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:'.selected'},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:'.selected'},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:'.selected'},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:'.selected'},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:'.selected'},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:'.selected'},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:'.selected'},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:'.selected'},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}});_e(function(E,$){E.fn.initDefaultConfig=function(){var editor=this;editor.config=$.extend({},E.config);editor.UI=$.extend({},E.UI)}});_e(function(E,$){E.fn.addEditorContainer=function(){this.$editorContainer=$('<div class="wangEditor-container"></div>')}});_e(function(E,$){E.fn.addTxt=function(){var editor=this;var txt=new E.Txt(editor);editor.txt=txt}});_e(function(E,$){E.fn.addMenuContainer=function(){var editor=this;editor.menuContainer=new E.MenuContainer(editor)}});_e(function(E,$){E.createMenuFns=[];E.createMenu=function(fn){E.createMenuFns.push(fn)};E.fn.addMenus=function(){var editor=this;var menuIds=editor.config.menus;function check(menuId){if(menuIds.indexOf(menuId)>=0){return true}return false}$.each(E.createMenuFns,function(k,createMenuFn){createMenuFn.call(editor,check)})}});_e(function(E,$){E.createMenu(function(check){var menuId='bold';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.bold,commandName:'Bold'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Bold')}else{editor.commandForElem('b,strong,h1,h2,h3,h4,h5',e,'Bold')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='underline';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.underline,commandName:'Underline'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Underline')}else{editor.commandForElem('u,a',e,'Underline')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='italic';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.italic,commandName:'Italic'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'Italic')}else{editor.commandForElem('i',e,'Italic')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='forecolor';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configColors=editor.config.colors;var menu=new E.Menu({editor:editor,id:menuId,title:lang.forecolor});var $content=$('<div></div>');$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(''))});$content.on('click','a[commandValue]',function(e){var $elem=$(this);var commandValue=$elem.attr('commandValue');if(menu.selected&&editor.isRangeEmpty()){editor.commandForElem('font[color]',e,'forecolor',commandValue)}else{editor.command(e,'forecolor',commandValue)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'font[color]');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='bgcolor';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configColors=editor.config.colors;function checkElemFn(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&cssText.indexOf('background-color:')>=0){return true}}return false}var menu=new E.Menu({editor:editor,id:menuId,title:lang.bgcolor});var $content=$('<div></div>');$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(''))});$content.on('click','a[commandValue]',function(e){var $elem=$(this);var commandValue=$elem.attr('commandValue');if(menu.selected&&editor.isRangeEmpty()){editor.commandForElem({selector:'span,font',check:checkElemFn},e,'BackColor',commandValue)}else{editor.command(e,'BackColor',commandValue)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'span,font',checkElemFn);if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='strikethrough';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.strikethrough,commandName:'StrikeThrough'});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'StrikeThrough')}else{editor.commandForElem('strike',e,'StrikeThrough')}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='eraser';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.eraser,commandName:'RemoveFormat'});menu.clickEvent=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'RemoveFormat');return}var $clearElem;function commandFn(){var editor=this;var rangeElem;var pElem,$pElem;var quoteElem,$quoteElem;var listElem,$listElem;rangeElem=editor.getRangeElem();quoteElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(quoteElem){$quoteElem=$(quoteElem);$clearElem=$('<p>'+$quoteElem.text()+'</p>');$quoteElem.after($clearElem).remove()}pElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5');if(pElem){$pElem=$(pElem);$clearElem=$('<p>'+$pElem.text()+'</p>');$pElem.after($clearElem).remove()}listElem=editor.getSelfOrParentByName(rangeElem,'ul,ol');if(listElem){$listElem=$(listElem);$clearElem=$('<p>'+$listElem.text()+'</p>');$listElem.after($clearElem).remove()}}function callback(){var editor=this;if($clearElem){editor.restoreSelectionByElem($clearElem.get(0))}}editor.customCommand(e,commandFn,callback)};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='source';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var txtHtml;var menu=new E.Menu({editor:editor,id:menuId,title:lang.source});menu.isShowCode=false;function updateValue(){var $code=menu.$codeTextarea;var $txt=editor.txt.$txt;var value=$.trim($code.val());if(!value){value='<p><br></p>'}if(editor.config.jsFilter){value=value.replace(/<script[\s\S]*?<\/script>/ig,'')}try{$txt.html(value)}catch(ex){}}menu.clickEvent=function(e){var self=this;var editor=self.editor;var $txt=editor.txt.$txt;var txtOuterHeight=$txt.outerHeight();var txtHeight=$txt.height();if(!self.$codeTextarea){self.$codeTextarea=$('<textarea class="code-textarea"></textarea>')}var $code=self.$codeTextarea;$code.css({height:txtHeight,'margin-top':txtOuterHeight-txtHeight});$code.val($txt.html());$code.on('change',function(e){updateValue()});$txt.after($code).hide();$code.show();menu.isShowCode=true;this.updateSelected();editor.disableMenusExcept('source');txtHtml=$txt.html()};menu.clickEventSelected=function(e){var self=this;var editor=self.editor;var $txt=editor.txt.$txt;var $code=self.$codeTextarea;var value;if(!$code){return}updateValue();$code.after($txt).hide();$txt.show();menu.isShowCode=false;this.updateSelected();editor.enableMenusExcept('source');if($txt.html()!==txtHtml){if(editor.onchange&&typeof editor.onchange==='function'){editor.onchange.call(editor)}}};menu.updateSelectedEvent=function(){return this.isShowCode};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='quote';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.quote,commandName:'formatBlock',commandValue:'blockquote'});menu.clickEvent=function(e){var rangeElem=editor.getRangeElem();var $rangeElem;if(!rangeElem){e.preventDefault();return}var currentQuote=editor.getSelfOrParentByName(rangeElem,'blockquote');var $quote;if(currentQuote){e.preventDefault();return}rangeElem=editor.getLegalTags(rangeElem);$rangeElem=$(rangeElem);if(!$rangeElem.text()){return}if(!rangeElem){editor.command(e,'formatBlock','blockquote');return}function commandFn(){$quote=$('<p>'+$rangeElem.text()+'</p>');$rangeElem.after($quote).remove();$quote.wrap('<blockquote>')}function callback(){var editor=this;if($quote){editor.restoreSelectionByElem($quote.get(0))}}editor.customCommand(e,commandFn,callback)};menu.clickEventSelected=function(e){var rangeElem;var quoteElem;var $lastChild;rangeElem=editor.getRangeElem();quoteElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(!quoteElem){e.preventDefault();return}function commandFn(){var $quoteElem;var $children;$quoteElem=$(quoteElem);$children=$quoteElem.children();if($children.length){$children.each(function(k){var $item=$(this);if($item.get(0).nodeName==='P'){$quoteElem.after($item)}else{$quoteElem.after('<p>'+$item.text()+'</p>')}$lastChild=$item;});$quoteElem.remove();return}}function callback(){var editor=this;if($lastChild){editor.restoreSelectionByElem($lastChild.get(0))}}editor.customCommand(e,commandFn,callback)};menu.updateSelectedEvent=function(){var self=this;var editor=self.editor;var rangeElem;rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(rangeElem){return true}return false};editor.menus[menuId]=menu;editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var isPrevEnter=false;$txt.on('keydown',function(e){if(e.keyCode!==13){isPrevEnter=false;return}var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(!rangeElem){isPrevEnter=false;return}if(!isPrevEnter){isPrevEnter=true;return}var currentRangeElem=editor.getRangeElem();var $currentRangeElem=$(currentRangeElem);if($currentRangeElem.length){$currentRangeElem.parent().after($currentRangeElem)}editor.restoreSelectionByElem(currentRangeElem,'start');isPrevEnter=false;e.preventDefault()})});editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var $rangeElem;function commandFn(){$rangeElem&&$rangeElem.remove()}function callback(){if(!$rangeElem){return}var $prev=$rangeElem.prev();if($prev.length){editor.restoreSelectionByElem($prev.get(0))}else{editor.initSelection()}}$txt.on('keydown',function(e){if(e.keyCode!==8){return}var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'blockquote');if(!rangeElem){return}$rangeElem=$(rangeElem);var text=$rangeElem.text();if(text){return}editor.customCommand(e,commandFn,callback)});});})});_e(function(E,$){E.createMenu(function(check){var menuId='fontfamily';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configFamilys=editor.config.familys;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fontfamily,commandName:'fontName'});var data={};$.each(configFamilys,function(k,v){data[v]=v});var tpl='<span style="font-family:{#commandValue};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:'font[face]'});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'font[face]');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='fontsize';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configSize=editor.config.fontsizes;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fontsize,commandName:'fontSize'});var data=configSize;var tpl='<span style="font-size:{#title};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:'font[size]'});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'font[size]');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='head';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.head,commandName:'formatBlock'});var data={'<h1>':'标题1','<h2>':'标题2','<h3>':'标题3','<h4>':'标题4','<h5>':'标题5'};var isOrderedList;function beforeEvent(e){if(editor.queryCommandState('InsertOrderedList')){isOrderedList=true;editor.command(e,'InsertOrderedList')}else{isOrderedList=false}}function afterEvent(e){if(isOrderedList){editor.command(e,'InsertOrderedList')}}var tpl='{#commandValue}{#title}';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,beforeEvent:beforeEvent,afterEvent:afterEvent});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'h1,h2,h3,h4,h5');if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='unorderlist';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.unorderlist,commandName:'InsertUnorderedList'});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='orderlist';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.orderlist,commandName:'InsertOrderedList'});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='alignleft';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.alignleft,commandName:'JustifyLeft'});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5,li',function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*left;/.test(cssText)){return true}}if($(elem).attr('align')==='left'){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='aligncenter';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.aligncenter,commandName:'JustifyCenter'});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5,li',function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*center;/.test(cssText)){return true}}if($(elem).attr('align')==='center'){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='alignright';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.alignright,commandName:'JustifyRight'});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5,li',function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*right;/.test(cssText)){return true}}if($(elem).attr('align')==='right'){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='link';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.link});var $content=$('<div></div>');var $div1=$('<div style="margin:20px 10px;" class="clearfix"></div>');var $div2=$div1.clone();var $div3=$div1.clone().css('margin','0 10px');var $textInput=$('<input type="text" class="block" placeholder="'+lang.text+'"/>');var $urlInput=$('<input type="text" class="block" placeholder="'+lang.link+'"/>');var $btnSubmit=$('<button class="right">'+lang.submit+'</button>');var $btnCancel=$('<button class="right gray">'+lang.cancel+'</button>');$div1.append($textInput);$div2.append($urlInput);$div3.append($btnSubmit).append($btnCancel);$content.append($div1).append($div2).append($div3);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:300});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}$textInput.val('');$urlInput.val('http://');var url='';var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'a');if(rangeElem){url=rangeElem.href||''}var text='';var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){text=editor.getRangeText()||''}else if(rangeElem){text=rangeElem.textContent||rangeElem.innerHTML}url&&$urlInput.val(url);text&&$textInput.val(text);if(!isRangeEmpty){$textInput.attr('disabled',true)}else{$textInput.removeAttr('disabled')}dropPanel.show()};menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'a');if(rangeElem){return true}return false};$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,'a');var isRangeEmpty=editor.isRangeEmpty();var $linkElem,linkHtml;var commandFn,callback;var $txt=editor.txt.$txt;var $oldLinks,$newLinks;var uniqId='link'+E.random();var url=$.trim($urlInput.val());var text=$.trim($textInput.val());if(!url){menu.dropPanel.focusFirstInput();return}if(!text){text=url}if(!isRangeEmpty){$oldLinks=$txt.find('a');$oldLinks.attr(uniqId,'1');editor.command(e,'createLink',url);$newLinks=$txt.find('a').not('['+uniqId+']');$newLinks.attr('target','_blank');$oldLinks.removeAttr(uniqId)}else if(targetElem){$linkElem=$(targetElem);commandFn=function(){$linkElem.attr('href',url);$linkElem.text(text)};callback=function(){var editor=this;editor.restoreSelectionByElem(targetElem)};editor.customCommand(e,commandFn,callback)}else{linkHtml='<a href="'+url+'" target="_blank">'+text+'</a>';if(E.userAgent.indexOf('Firefox')>0){linkHtml+='<span>&nbsp;</span>'}editor.command(e,'insertHtml',linkHtml)}});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='unlink';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.unlink,commandName:'unLink'});menu.clickEvent=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,'unLink');return}var rangeElem=editor.getRangeElem();var aElem=editor.getSelfOrParentByName(rangeElem,'a');if(!aElem){e.preventDefault();return}var $a=$(aElem);var $span=$('<span>'+$a.text()+'</span>');function commandFn(){$a.after($span).remove()}function callback(){editor.restoreSelectionByElem($span.get(0))}editor.customCommand(e,commandFn,callback)};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='table';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.table});var $content=$('<div style="font-size: 14px; color: #666; text-align:right;"></div>');var $table=$('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">');var $row=$('<span>0</span>');var $rowspan=$('<span> 行 </span>');var $col=$('<span>0</span>');var $colspan=$('<span> 列</span>');var $tr;var i,j;for(i=0;i<15;i+=1){$tr=$('<tr index="'+(i+1)+'">');for(j=0;j<20;j+=1){$tr.append($('<td index="'+(j+1)+'">'))}$table.append($tr)}$content.append($table);$content.append($row).append($rowspan).append($col).append($colspan);$table.on('mouseenter','td',function(e){var $currentTd=$(e.currentTarget);var currentTdIndex=$currentTd.attr('index');var $currentTr=$currentTd.parent();var currentTrIndex=$currentTr.attr('index');$row.text(currentTrIndex);$col.text(currentTdIndex);$table.find('tr').each(function(){var $tr=$(this);var trIndex=$tr.attr('index');if(parseInt(trIndex,10)<=parseInt(currentTrIndex,10)){$tr.find('td').each(function(){var $td=$(this);var tdIndex=$td.attr('index');if(parseInt(tdIndex,10)<=parseInt(currentTdIndex,10)){$td.addClass('active')}else{$td.removeClass('active')}})}else{$tr.find('td').removeClass('active')}})}).on('mouseleave',function(e){$table.find('td').removeClass('active');$row.text(0);$col.text(0)});$table.on('click','td',function(e){var $currentTd=$(e.currentTarget);var currentTdIndex=$currentTd.attr('index');var $currentTr=$currentTd.parent();var currentTrIndex=$currentTr.attr('index');var rownum=parseInt(currentTrIndex,10);var colnum=parseInt(currentTdIndex,10);var i,j;var tableHtml='<table>';for(i=0;i<rownum;i+=1){tableHtml+='<tr>';for(j=0;j<colnum;j+=1){tableHtml+='<td><span>&nbsp;</span></td>'}tableHtml+='</tr>'}tableHtml+='</table>';editor.command(e,'insertHtml',tableHtml)});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:262});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='emotion';if(!check(menuId)){return}var editor=this;var config=editor.config;var lang=config.lang;var configEmotions=config.emotions;var emotionsShow=config.emotionsShow;editor.emotionUrls=[];var menu=new E.Menu({editor:editor,id:menuId,title:lang.emotion});function insertEmotionImgs(data,$tabContent){$.each(data,function(k,emotion){var src=emotion.icon||emotion.url;var value=emotion.value||emotion.title;var commandValue=emotionsShow==='icon'?src:value;var $command=$('<a href="#" commandValue="'+commandValue+'"></a>');var $img=$('<img>');$img.attr('_src',src);$command.append($img);$tabContent.append($command);editor.emotionUrls.push(src)})}var $panelContent=$('<div class="panel-tab"></div>');var $tabContainer=$('<div class="tab-container"></div>');var $contentContainer=$('<div class="content-container emotion-content-container"></div>');$.each(configEmotions,function(k,emotion){var title=emotion.title;var data=emotion.data;E.log('正在处理 '+title+' 表情的数据...');var $tab=$('<a href="#">'+title+' </a>');$tabContainer.append($tab);var $tabContent=$('<div class="content"></div>');$contentContainer.append($tabContent);$tab.click(function(e){$tabContainer.children().removeClass('selected');$contentContainer.children().removeClass('selected');$tabContent.addClass('selected');$tab.addClass('selected');e.preventDefault()});if(typeof data==='string'){E.log('将通过 '+data+' 地址ajax下载表情包');$.get(data,function(result){result=$.parseJSON(result);E.log('下载完毕，得到 '+result.length+' 个表情');insertEmotionImgs(result,$tabContent)})}else if(Object.prototype.toString.call(data).toLowerCase().indexOf('array')>0){insertEmotionImgs(data,$tabContent)}else{E.error('data 数据格式错误，请修改为正确格式，参考文档：'+E.docsite);return}});$panelContent.append($tabContainer).append($contentContainer);$tabContainer.children().first().addClass('selected');$contentContainer.children().first().addClass('selected');$contentContainer.on('click','a[commandValue]',function(e){var $a=$(e.currentTarget);var commandValue=$a.attr('commandValue');var img;if(emotionsShow==='icon'){editor.command(e,'InsertImage',commandValue)}else{editor.command(e,'insertHtml','<span>'+commandValue+'</span>')}e.preventDefault()});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:350});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}dropPanel.show();if(menu.imgLoaded){return}$contentContainer.find('img').each(function(){var $img=$(this);var _src=$img.attr('_src');$img.on('error',function(){E.error('加载不出表情图片 '+_src)});$img.attr('src',_src);$img.removeAttr('_src')});menu.imgLoaded=true};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='img';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.img});var $panelContent=$('<div class="panel-tab"></div>');var $tabContainer=$('<div class="tab-container"></div>');var $contentContainer=$('<div class="content-container"></div>');$panelContent.append($tabContainer).append($contentContainer);var $uploadTab=$('<a href="#">上传图片</a>');var $linkTab=$('<a href="#">网络图片</a>');$tabContainer.append($uploadTab).append($linkTab);var $uploadContent=$('<div class="content"></div>');$contentContainer.append($uploadContent);var $linkContent=$('<div class="content"></div>');$contentContainer.append($linkContent);linkContentHandler(editor,menu,$linkContent);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:400,onRender:function(){var init=editor.config.customUploadInit;init&&init.call(editor)}});editor.menus[menuId]=menu;function tabToggle(){$uploadTab.click(function(e){$tabContainer.children().removeClass('selected');$contentContainer.children().removeClass('selected');$uploadContent.addClass('selected');$uploadTab.addClass('selected');e.preventDefault()});$linkTab.click(function(e){$tabContainer.children().removeClass('selected');$contentContainer.children().removeClass('selected');$linkContent.addClass('selected');$linkTab.addClass('selected');e.preventDefault();if(E.placeholder){$linkContent.find('input[type=text]').focus()}});$uploadTab.click()}function hideUploadImg(){$tabContainer.remove();$uploadContent.remove();$linkContent.addClass('selected')}function hideLinkImg(){$tabContainer.remove();$linkContent.remove();$uploadContent.addClass('selected')}editor.ready(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var customUpload=config.customUpload;var linkImg=config.hideLinkImg;var $uploadImgPanel;if(uploadImgUrl||customUpload){editor.$uploadContent=$uploadContent;tabToggle();if(linkImg){hideLinkImg()}}else{hideUploadImg()}function hidePanel(){menu.dropPanel.hide()}$uploadContent.click(function(){setTimeout(hidePanel)})})});function linkContentHandler(editor,menu,$linkContent){var lang=editor.config.lang;var $urlContainer=$('<div style="margin:20px 10px 10px 10px;"></div>');var $urlInput=$('<input type="text" class="block" placeholder="http://"/>');$urlContainer.append($urlInput);var $btnSubmit=$('<button class="right">'+lang.submit+'</button>');var $btnCancel=$('<button class="right gray">'+lang.cancel+'</button>');$linkContent.append($urlContainer).append($btnSubmit).append($btnCancel);$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});function callback(){$urlInput.val('')}$btnSubmit.click(function(e){e.preventDefault();var url=$.trim($urlInput.val());if(!url){$urlInput.focus();return}var imgHtml='<img style="max-width:100%;" src="'+url+'"/>';editor.command(e,'insertHtml',imgHtml,callback)})}});_e(function(E,$){E.createMenu(function(check){var menuId='video';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var reg=/^<(iframe)|(embed)/i;var menu=new E.Menu({editor:editor,id:menuId,title:lang.video});var $content=$('<div></div>');var $linkInputContainer=$('<div style="margin:20px 10px;"></div>');var $linkInput=$('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');$linkInputContainer.append($linkInput);var $sizeContainer=$('<div style="margin:20px 10px;"></div>');var $widthInput=$('<input type="text" value="640" style="width:50px;text-align:center;"/>');var $heightInput=$('<input type="text" value="498" style="width:50px;text-align:center;"/>');$sizeContainer.append('<span> '+lang.width+' </span>').append($widthInput).append('<span> px &nbsp;&nbsp;&nbsp;</span>').append('<span> '+lang.height+' </span>').append($heightInput).append('<span> px </span>');var $btnContainer=$('<div></div>');var $howToCopy=$('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>');var $btnSubmit=$('<button class="right">'+lang.submit+'</button>');var $btnCancel=$('<button class="right gray">'+lang.cancel+'</button>');$btnContainer.append($howToCopy).append($btnSubmit).append($btnCancel);$content.append($linkInputContainer).append($sizeContainer).append($btnContainer);$btnCancel.click(function(e){e.preventDefault();$linkInput.val('');menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var link=$.trim($linkInput.val());var $link;var width=parseInt($widthInput.val());var height=parseInt($heightInput.val());var $div=$('<div>');var html='<p>{content}</p>';if(!link){menu.dropPanel.focusFirstInput();return}if(!reg.test(link)){alert('视频链接格式错误！');menu.dropPanel.focusFirstInput();return}if(isNaN(width)||isNaN(height)){alert('宽度或高度不是数字！');return}$link=$(link);$link.attr('width',width).attr('height',height);html=html.replace('{content}',$div.append($link).html());editor.command(e,'insertHtml',html);$linkInput.val('')});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:400});editor.menus[menuId]=menu})});_e(function(E,$){var inputKeyup=(function(input){return 'onkeyup'in input})(document.createElement('input'));E.baiduMapAk='TVhjYjq1ICT2qqL5LdS8mwas';E.numberOfLocation=0;E.createMenu(function(check){var menuId='location';if(!check(menuId)){return}if(++E.numberOfLocation>1){E.error('目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单');return}var editor=this;var config=editor.config;var lang=config.lang;var ak=config.mapAk;editor.mapData={};var mapData=editor.mapData;mapData.markers=[];mapData.mapContainerId='map'+E.random();mapData.clearLocations=function(){var map=mapData.map;if(!map){return}map.clearOverlays();mapData.markers=[]};mapData.searchMap=function(){var map=mapData.map;if(!map){return}var BMap=window.BMap;var cityName=$cityInput.val();var locationName=$searchInput.val();var myGeo,marker;if(cityName!==''){if(!locationName||locationName===''){map.centerAndZoom(cityName,11)}if(locationName&&locationName!==''){myGeo=new BMap.Geocoder();myGeo.getPoint(locationName,function(point){if(point){map.centerAndZoom(point,13);marker=new BMap.Marker(point);map.addOverlay(marker);marker.enableDragging();mapData.markers.push(marker);}else{map.centerAndZoom(cityName,11);}},cityName)}}};var hasCallback=false;window.baiduMapCallBack=function(){if(hasCallback){return}else{hasCallback=true}var BMap=window.BMap;if(!mapData.map){mapData.map=new BMap.Map(mapData.mapContainerId)}var map=mapData.map;map.centerAndZoom(new BMap.Point(116.404,39.915),11);map.addControl(new BMap.MapTypeControl());map.setCurrentCity("北京");map.enableScrollWheelZoom(true);function locationFun(result){var cityName=result.name;map.setCenter(cityName);$cityInput.val(cityName);if(E.placeholder){$searchInput.focus()}var timeoutId,searchFn;if(inputKeyup){searchFn=function(e){if(e.type==='keyup'&&e.keyCode===13){e.preventDefault()}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(mapData.searchMap,500)};$cityInput.on('keyup change paste',searchFn);$searchInput.on('keyup change paste',searchFn)}else{searchFn=function(){if(!$content.is(':visible')){clearTimeout(timeoutId);return}var currentCity='';var currentSearch='';var city=$cityInput.val();var search=$searchInput.val();if(city!==currentCity||search!==currentSearch){mapData.searchMap();currentCity=city;currentSearch=search}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(searchFn,1000)};timeoutId=setTimeout(searchFn,1000)}}var myCity=new BMap.LocalCity();myCity.get(locationFun);map.addEventListener("click",function(e){var marker=new BMap.Marker(new BMap.Point(e.point.lng,e.point.lat));map.addOverlay(marker);marker.enableDragging();mapData.markers.push(marker);},false)};mapData.loadMapScript=function(){var script=document.createElement("script");script.type="text/javascript";script.src="https://api.map.baidu.com/api?v=2.0&ak="+ak+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(script)}catch(ex){E.error('加载地图过程中发生错误')}};mapData.initMap=function(){if(window.BMap){window.baiduMapCallBack()}else{mapData.loadMapScript()}};var menu=new E.Menu({editor:editor,id:menuId,title:lang.location});editor.menus[menuId]=menu;var $content=$('<div></div>');var $inputContainer=$('<div style="margin:10px 0;"></div>');var $cityInput=$('<input type="text"/>');$cityInput.css({width:'80px','text-align':'center'});var $searchInput=$('<input type="text"/>');$searchInput.css({width:'300px','margin-left':'10px'}).attr('placeholder',lang.searchlocation);var $clearBtn=$('<button class="right link">'+lang.clearLocation+'</button>');$inputContainer.append($clearBtn).append($cityInput).append($searchInput);$content.append($inputContainer);$clearBtn.click(function(e){$searchInput.val('');$searchInput.focus();mapData.clearLocations();e.preventDefault()});var $map=$('<div id="'+mapData.mapContainerId+'"></div>');$map.css({height:'260px',width:'100%',position:'relative','margin-top':'10px',border:'1px solid #f1f1f1'});var $mapLoading=$('<span>'+lang.loading+'</span>');$mapLoading.css({position:'absolute',width:'100px','text-align':'center',top:'45%',left:'50%','margin-left':'-50px'});$map.append($mapLoading);$content.append($map);var $btnContainer=$('<div style="margin:10px 0;"></div>');var $btnSubmit=$('<button class="right">'+lang.submit+'</button>');var $btnCancel=$('<button class="right gray">'+lang.cancel+'</button>');var $checkLabel=$('<label style="display:inline-block;margin-top:10px;color:#666;"></label>');var $check=$('<input type="checkbox">');$checkLabel.append($check).append('<span style="display:inline-block;margin-left:5px;">  '+lang.dynamicMap+'</span>');$btnContainer.append($checkLabel).append($btnSubmit).append($btnCancel);$content.append($btnContainer);function callback(){$searchInput.val('')}$btnCancel.click(function(e){e.preventDefault();callback();menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var map=mapData.map,isDynamic=$check.is(':checked'),markers=mapData.markers,center=map.getCenter(),centerLng=center.lng,centerLat=center.lat,zoom=map.getZoom(),size=map.getSize(),sizeWidth=size.width,sizeHeight=size.height,position,src,iframe;if(isDynamic){src='http://ueditor.baidu.com/ueditor/dialogs/map/show.html#'}else{src='http://api.map.baidu.com/staticimage?'}src=src+'center='+centerLng+','+centerLat+'&zoom='+zoom+'&width='+sizeWidth+'&height='+sizeHeight;if(markers.length>0){src=src+'&markers=';$.each(markers,function(key,value){position=value.getPosition();if(key>0){src=src+'|'}src=src+position.lng+','+position.lat})}if(isDynamic){if(markers.length>1){alert(lang.langDynamicOneLocation);return}src+='&markerStyles=l,A';iframe='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+sizeWidth+'" height="'+sizeHeight+'"></iframe>';iframe=iframe.replace('{src}',src);editor.command(e,'insertHtml',iframe,callback)}else{editor.command(e,'insertHtml','<img style="max-width:100%;" src="'+src+'"/>',callback)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500});menu.onRender=function(){if(ak===E.baiduMapAk){E.warn('建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档：'+E.docsite)}};menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;var firstTime=false;if(dropPanel.isShowing){dropPanel.hide();return}if(!mapData.map){firstTime=true}dropPanel.show();mapData.initMap();if(!firstTime){$searchInput.focus()}}})});_e(function(E,$){function loadHljs(){if(E.userAgent.indexOf('MSIE 8')>0){return}if(window.hljs){return}var script=document.createElement("script");script.type="text/javascript";script.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js";document.body.appendChild(script)}E.createMenu(function(check){var menuId='insertcode';if(!check(menuId)){return}setTimeout(loadHljs,0);var editor=this;var config=editor.config;var lang=config.lang;var $txt=editor.txt.$txt;var menu=new E.Menu({editor:editor,id:menuId,title:lang.insertcode});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}$textarea.val('');dropPanel.show();var hljs=window.hljs;if(hljs&&hljs.listLanguages){if($langSelect.children().length!==0){return}$langSelect.css({'margin-top':'9px','margin-left':'5px'});$.each(hljs.listLanguages(),function(key,lang){if(lang==='xml'){lang='html'}if(lang===config.codeDefaultLang){$langSelect.append('<option value="'+lang+'" selected="selected">'+lang+'</option>')}else{$langSelect.append('<option value="'+lang+'">'+lang+'</option>')}})}else{$langSelect.hide()}};menu.clickEventSelected=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}dropPanel.show();var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,'pre');var $targetElem;var className;if(targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,'code')}if(!targetElem){return}$targetElem=$(targetElem);$textarea.val($targetElem.text());if($langSelect){className=$targetElem.attr('class');if(className){$langSelect.val(className.split(' ')[0])}}};menu.updateSelectedEvent=function(){var self=this;var editor=self.editor;var rangeElem;rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,'pre');if(rangeElem){return true}return false};var $content=$('<div></div>');var $textarea=$('<textarea></textarea>');var $langSelect=$('<select></select>');contentHandle($content);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500});editor.menus[menuId]=menu;function contentHandle($content){var $textareaContainer=$('<div></div>');$textareaContainer.css({margin:'15px 5px 5px 5px',height:'160px','text-align':'center'});$textarea.css({width:'100%',height:'100%',padding:'10px'});$textarea.on('keydown',function(e){if(e.keyCode===9){e.preventDefault()}});$textareaContainer.append($textarea);$content.append($textareaContainer);var $btnContainer=$('<div></div>');var $btnSubmit=$('<button class="right">'+lang.submit+'</button>');var $btnCancel=$('<button class="right gray">'+lang.cancel+'</button>');$btnContainer.append($btnSubmit).append($btnCancel).append($langSelect);$content.append($btnContainer);$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});var codeTpl='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';$btnSubmit.click(function(e){e.preventDefault();var val=$textarea.val();if(!val){$textarea.focus();return}var rangeElem=editor.getRangeElem();if($.trim($(rangeElem).text())&&codeTpl.indexOf('<p><br></p>')!==0){codeTpl='<p><br></p>'+codeTpl}var lang=$langSelect?$langSelect.val():'';var langClass='';var doHightlight=function(){$txt.find('pre code').each(function(i,block){var $block=$(block);if($block.attr('codemark')){return}else if(window.hljs){window.hljs.highlightBlock(block);$block.attr('codemark','1')}})};if(lang){langClass=' class="'+lang+' hljs"'}val=val.replace(/&/gm,'&amp;').replace(/</gm,'&lt;').replace(/>/gm,'&gt;');if(!menu.selected){var html=codeTpl.replace('{#langClass}',langClass).replace('{#content}',val);editor.command(e,'insertHtml',html,doHightlight);return}var targetElem=editor.getSelfOrParentByName(rangeElem,'pre');var $targetElem;if(targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,'code')}if(!targetElem){return}$targetElem=$(targetElem);function commandFn(){var className;if(lang){className=$targetElem.attr('class');if(className!==lang+' hljs'){$targetElem.attr('class',lang+' hljs')}}$targetElem.html(val)}function callback(){editor.restoreSelectionByElem(targetElem);doHightlight()}editor.customCommand(e,commandFn,callback)})}$txt.on('keydown',function(e){if(e.keyCode!==13){return}var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,'code');if(!targetElem){return}editor.command(e,'insertHtml','\n')});function updateMenu(){var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,'code');if(targetElem){editor.disableMenusExcept('insertcode')}else{editor.enableMenusExcept('insertcode')}}$txt.on('keydown click',function(e){setTimeout(updateMenu)})})});_e(function(E,$){E.createMenu(function(check){var menuId='undo';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.undo});menu.clickEvent=function(e){editor.undo()};editor.menus[menuId]=menu;editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var timeoutId;function undo(){editor.undoRecord()}$txt.on('keydown',function(e){var keyCode=e.keyCode;if(e.ctrlKey&&keyCode===90){editor.undo();return}if(keyCode===13){undo()}else{if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(undo,1000)}});editor.undoRecord()})})});_e(function(E,$){E.createMenu(function(check){var menuId='redo';if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.redo});menu.clickEvent=function(e){editor.redo()};editor.menus[menuId]=menu})});_e(function(E,$){var scrollTopWhenFullScreen;E.createMenu(function(check){var menuId='fullscreen';if(!check(menuId)){return}var editor=this;var $txt=editor.txt.$txt;var config=editor.config;var zIndexConfig=config.zindex||10000;var lang=config.lang;var isSelected=false;var zIndex;var maxHeight;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fullscreen});menu.clickEvent=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.addClass('wangEditor-fullscreen');zIndex=$editorContainer.css('z-index');$editorContainer.css('z-index',zIndexConfig);var $wrapper;var txtHeight=$txt.height();var txtOuterHeight=$txt.outerHeight();if(editor.useMaxHeight){maxHeight=$txt.css('max-height');$txt.css('max-height','none');$wrapper=$txt.parent();$wrapper.after($txt);$wrapper.remove();$txt.css('overflow-y','auto')}var menuContainer=editor.menuContainer;$txt.height(E.$window.height()-menuContainer.height()-(txtOuterHeight-txtHeight));editor.menuContainer.$menuContainer.attr('style','');isSelected=true;editor.isFullScreen=true;scrollTopWhenFullScreen=E.$window.scrollTop()};menu.clickEventSelected=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.removeClass('wangEditor-fullscreen');$editorContainer.css('z-index',zIndex);if(editor.useMaxHeight){$txt.css('max-height',maxHeight)}else{editor.$valueContainer.css('height',editor.valueContainerHeight)}editor.txt.initHeight();isSelected=false;editor.isFullScreen=false;if(scrollTopWhenFullScreen!=null){E.$window.scrollTop(scrollTopWhenFullScreen)}};menu.updateSelectedEvent=function(e){return isSelected};editor.menus[menuId]=menu})});_e(function(E,$){E.fn.renderMenus=function(){var editor=this;var menus=editor.menus;var menuIds=editor.config.menus;var menuContainer=editor.menuContainer;var menu;var groupIdx=0;$.each(menuIds,function(k,v){if(v==='|'){groupIdx+=1;return}menu=menus[v];if(menu){menu.render(groupIdx)}})}});_e(function(E,$){E.fn.renderMenuContainer=function(){var editor=this;var menuContainer=editor.menuContainer;var $editorContainer=editor.$editorContainer;menuContainer.render()}});_e(function(E,$){E.fn.renderTxt=function(){var editor=this;var txt=editor.txt;txt.render();editor.ready(function(){txt.initHeight()})}});_e(function(E,$){E.fn.renderEditorContainer=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $editorContainer=editor.$editorContainer;var $txt=editor.txt.$txt;var $prev,$parent;if($valueContainer===$txt){$prev=editor.$prev;$parent=editor.$parent;if($prev&&$prev.length){$prev.after($editorContainer)}else{$parent.prepend($editorContainer)}}else{$valueContainer.after($editorContainer);$valueContainer.hide()}}});_e(function(E,$){E.fn.eventMenus=function(){var menus=this.menus;$.each(menus,function(k,v){v.bindEvent()})}});_e(function(E,$){E.fn.eventMenuContainer=function(){}});_e(function(E,$){E.fn.eventTxt=function(){var txt=this.txt;txt.saveSelectionEvent();txt.updateValueEvent();txt.updateMenuStyleEvent();}});_e(function(E,$){E.plugin(function(){var editor=this;var fns=editor.config.uploadImgFns;fns.onload||(fns.onload=function(resultText,xhr){E.log('上传结束，返回结果为 '+resultText);var editor=this;var originalName=editor.uploadImgOriginalName||'';var img;if(resultText.indexOf('error|')===0){E.warn('上传失败：'+resultText.split('|')[1]);alert(resultText.split('|')[1])}else{E.log('上传成功，即将插入编辑区域，结果为：'+resultText);img=document.createElement('img');img.onload=function(){var html='<img src="'+resultText+'" alt="'+originalName+'" style="max-width:100%;"/>';editor.command(null,'insertHtml',html);E.log('已插入图片，地址 '+resultText);img=null};img.onerror=function(){E.error('使用返回的结果获取图片，发生错误。请确认以下结果是否正确：'+resultText);img=null};img.src=resultText}});fns.ontimeout||(fns.ontimeout=function(xhr){E.error('上传图片超时');alert('上传图片超时')});fns.onerror||(fns.onerror=function(xhr){E.error('上传上图片发生错误');alert('上传上图片发生错误')})})});_e(function(E,$){if(!window.FileReader||!window.FormData){return}E.plugin(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadTimeout=config.uploadTimeout;var uploadImgFns=config.uploadImgFns;var onload=uploadImgFns.onload;var ontimeout=uploadImgFns.ontimeout;var onerror=uploadImgFns.onerror;if(!uploadImgUrl){return}function convertBase64UrlToBlob(urlData,filetype){var bytes=window.atob(urlData.split(',')[1]);var ab=new ArrayBuffer(bytes.length);var ia=new Uint8Array(ab);var i;for(i=0;i<bytes.length;i+=1){ia[i]=bytes.charCodeAt(i)}return new Blob([ab],{type:filetype})}function insertImg(src,event){var img=document.createElement('img');img.onload=function(){var html='<img src="'+src+'" style="max-width:100%;"/>';editor.command(event,'insertHtml',html);E.log('已插入图片，地址 '+src);img=null};img.onerror=function(){E.error('使用返回的结果获取图片，发生错误。请确认以下结果是否正确：'+src);img=null};img.src=src}function updateProgress(e){if(e.lengthComputable){var percentComplete=e.loaded/e.total;editor.showUploadProgress(percentComplete*100)}}editor.xhrUploadImg=function(opt){var event=opt.event;var fileName=opt.filename||'';var base64=opt.base64;var fileType=opt.fileType||'image/png';var name=opt.name||'wangEditor_upload_file';var loadfn=opt.loadfn||onload;var errorfn=opt.errorfn||onerror;var timeoutfn=opt.timeoutfn||ontimeout;var params=editor.config.uploadParams||{};var headers=editor.config.uploadHeaders||{};var fileExt='png';if(fileName.indexOf('.')>0){fileExt=fileName.slice(fileName.lastIndexOf('.')-fileName.length+1)}else if(fileType.indexOf('/')>0&&fileType.split('/')[1]){fileExt=fileType.split('/')[1]}if(E.isOnWebsite){E.log('预览模拟上传');insertImg(base64,event);return}var xhr=new XMLHttpRequest();var timeoutId;var src;var formData=new FormData();function timeoutCallback(){if(timeoutId){clearTimeout(timeoutId)}if(xhr&&xhr.abort){xhr.abort()}event.preventDefault();timeoutfn&&timeoutfn.call(editor,xhr);editor.hideUploadProgress()}xhr.onload=function(){if(timeoutId){clearTimeout(timeoutId)}editor.uploadImgOriginalName=fileName;if(fileName.indexOf('.')>0){editor.uploadImgOriginalName=fileName.split('.')[0]}loadfn&&loadfn.call(editor,xhr.responseText,xhr);editor.hideUploadProgress()};xhr.onerror=function(){if(timeoutId){clearTimeout(timeoutId)}event.preventDefault();errorfn&&errorfn.call(editor,xhr);editor.hideUploadProgress()};xhr.upload.onprogress=updateProgress;formData.append(name,convertBase64UrlToBlob(base64,fileType),E.random()+'.'+fileExt);$.each(params,function(key,value){formData.append(key,value)});xhr.open('POST',uploadImgUrl,true);$.each(headers,function(key,value){xhr.setRequestHeader(key,value)});xhr.withCredentials=true;xhr.send(formData);timeoutId=setTimeout(timeoutCallback,uploadTimeout);E.log('开始上传...并开始超时计算')}})});_e(function(E,$){E.plugin(function(){var editor=this;var menuContainer=editor.menuContainer;var menuHeight=menuContainer.height();var $editorContainer=editor.$editorContainer;var width=$editorContainer.width();var $progress=$('<div class="wangEditor-upload-progress"></div>');var isRender=false;function render(){if(isRender){return}isRender=true;$progress.css({top:menuHeight+'px'});$editorContainer.append($progress)}editor.showUploadProgress=function(progress){if(timeoutId){clearTimeout(timeoutId)}render();$progress.show();$progress.width(progress*width/100)};var timeoutId;function hideProgress(){$progress.hide();timeoutId=null}editor.hideUploadProgress=function(time){if(timeoutId){clearTimeout(timeoutId)}time=time||750;timeoutId=setTimeout(hideProgress,time)}})});_e(function(E,$){E.plugin(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadTimeout=config.uploadTimeout;var event;if(!uploadImgUrl){return}var $uploadContent=editor.$uploadContent;if(!$uploadContent){return}var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var upfile=new E.UploadFile({editor:editor,uploadUrl:uploadImgUrl,timeout:uploadTimeout,fileAccept:'image/jpg,image/jpeg,image/png,image/gif,image/bmp'});$uploadIcon.click(function(e){event=e;upfile.selectFiles()})})});_e(function(E,$){if(!window.FileReader||!window.FormData){return}var UploadFile=function(opt){this.editor=opt.editor;this.uploadUrl=opt.uploadUrl;this.timeout=opt.timeout;this.fileAccept=opt.fileAccept;this.multiple=true};UploadFile.fn=UploadFile.prototype;UploadFile.fn.clear=function(){this.$input.val('');E.log('input value 已清空')};UploadFile.fn.render=function(){var self=this;if(self._hasRender){return}E.log('渲染dom');var fileAccept=self.fileAccept;var acceptTpl=fileAccept?'accept="'+fileAccept+'"':'';var multiple=self.multiple;var multipleTpl=multiple?'multiple="multiple"':'';var $input=$('<input type="file" '+acceptTpl+' '+multipleTpl+'/>');var $container=$('<div style="visibility:hidden;"></div>');$container.append($input);E.$body.append($container);$input.on('change',function(e){self.selected(e,$input.get(0))});self.$input=$input;self._hasRender=true};UploadFile.fn.selectFiles=function(){var self=this;E.log('使用 html5 方式上传');self.render();E.log('选择文件');self.$input.click()};UploadFile.fn.selected=function(e,input){var self=this;var files=input.files||[];if(files.length===0){return}E.log('选中 '+files.length+' 个文件');$.each(files,function(key,value){self.upload(value)})};UploadFile.fn.upload=function(file){var self=this;var editor=self.editor;var filename=file.name||'';var fileType=file.type||'';var uploadImgFns=editor.config.uploadImgFns;var uploadFileName=editor.config.uploadImgFileName||'wangEditorH5File';var onload=uploadImgFns.onload;var ontimeout=uploadImgFns.ontimeout;var onerror=uploadImgFns.onerror;var reader=new FileReader();if(!onload||!ontimeout||!onerror){E.error('请为编辑器配置上传图片的 onload ontimeout onerror 回调事件');return}E.log('开始执行 '+filename+' 文件的上传');function clearInput(){self.clear()}reader.onload=function(e){E.log('已读取'+filename+'文件');var base64=e.target.result||this.result;editor.xhrUploadImg({event:e,filename:filename,base64:base64,fileType:fileType,name:uploadFileName,loadfn:function(resultText,xhr){clearInput();var editor=this;onload.call(editor,resultText,xhr)},errorfn:function(xhr){clearInput();if(E.isOnWebsite){alert('wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生')}var editor=this;onerror.call(editor,xhr)},timeoutfn:function(xhr){clearInput();if(E.isOnWebsite){alert('wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生')}var editor=this;ontimeout(editor,xhr)}})};reader.readAsDataURL(file)};E.UploadFile=UploadFile});_e(function(E,$){if(window.FileReader&&window.FormData){return}var UploadFile=function(opt){this.editor=opt.editor;this.uploadUrl=opt.uploadUrl;this.timeout=opt.timeout;this.fileAccept=opt.fileAccept;this.multiple=false};UploadFile.fn=UploadFile.prototype;UploadFile.fn.clear=function(){this.$input.val('');E.log('input value 已清空')};UploadFile.fn.hideModal=function(){this.modal.hide()};UploadFile.fn.render=function(){var self=this;var editor=self.editor;var uploadFileName=editor.config.uploadImgFileName||'wangEditorFormFile';if(self._hasRender){return}var uploadUrl=self.uploadUrl;E.log('渲染dom');var iframeId='iframe'+E.random();var $iframe=$('<iframe name="'+iframeId+'" id="'+iframeId+'" frameborder="0" width="0" height="0"></iframe>');var multiple=self.multiple;var multipleTpl=multiple?'multiple="multiple"':'';var $p=$('<p>选择图片并上传</p>');var $input=$('<input type="file" '+multipleTpl+' name="'+uploadFileName+'"/>');var $btn=$('<input type="submit" value="上传"/>');var $form=$('<form enctype="multipart/form-data" method="post" action="'+uploadUrl+'" target="'+iframeId+'"></form>');var $container=$('<div style="margin:10px 20px;"></div>');$form.append($p).append($input).append($btn);$.each(editor.config.uploadParams,function(key,value){$form.append($('<input type="hidden" name="'+key+'" value="'+value+'"/>'))});$container.append($form);$container.append($iframe);self.$input=$input;self.$iframe=$iframe;var modal=new E.Modal(editor,undefined,{$content:$container});self.modal=modal;self._hasRender=true};UploadFile.fn.bindLoadEvent=function(){var self=this;if(self._hasBindLoad){return}var editor=self.editor;var $iframe=self.$iframe;var iframe=$iframe.get(0);var iframeWindow=iframe.contentWindow;var onload=editor.config.uploadImgFns.onload;function onloadFn(){var resultText=$.trim(iframeWindow.document.body.innerHTML);if(!resultText){return}var fileFullName=self.$input.val();var fileOriginalName=fileFullName;if(fileFullName.lastIndexOf('\\')>=0){fileOriginalName=fileFullName.slice(fileFullName.lastIndexOf('\\')+1);if(fileOriginalName.indexOf('.')>0){fileOriginalName=fileOriginalName.split('.')[0]}}editor.uploadImgOriginalName=fileOriginalName;onload.call(editor,resultText);self.clear();self.hideModal()}if(iframe.attachEvent){iframe.attachEvent('onload',onloadFn)}else{iframe.onload=onloadFn}self._hasBindLoad=true};UploadFile.fn.show=function(){var self=this;var modal=self.modal;function show(){modal.show();self.bindLoadEvent()}setTimeout(show)};UploadFile.fn.selectFiles=function(){var self=this;E.log('使用 form 方式上传');self.render();self.clear();self.show()};E.UploadFile=UploadFile});_e(function(E,$){E.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadFileName=config.uploadImgFileName||'wangEditorPasteFile';var pasteEvent;var $imgsBeforePaste;if(!uploadImgUrl){return}function findPasteImgAndUpload(){var reg=/^data:(image\/\w+);base64/;var $imgs=$txt.find('img');E.log('粘贴后，检查到编辑器有'+$imgs.length+'个图片。开始遍历图片，试图找到刚刚粘贴过来的图片');$.each($imgs,function(){var img=this;var $img=$(img);var flag;var base64=$img.attr('src');var type;$imgsBeforePaste.each(function(){if(img===this){flag=true;return false}});if(flag){return}E.log('找到一个粘贴过来的图片');if(reg.test(base64)){E.log('src 是 base64 格式，可以上传');type=base64.match(reg)[1];editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:type,name:uploadFileName})}else{E.log('src 为 '+base64+' ，不是 base64 格式，暂时不支持上传')}$img.remove()});E.log('遍历结束')}$txt.on('paste',function(e){pasteEvent=e;var data=pasteEvent.clipboardData||pasteEvent.originalEvent.clipboardData;var text;var items;if(data==null){text=window.clipboardData&&window.clipboardData.getData('text')}else{text=data.getData('text/plain')||data.getData('text/html')}if(text){return}items=data&&data.items;if(items){E.log('通过 data.items 得到了数据');$.each(items,function(key,value){var fileType=value.type||'';if(fileType.indexOf('image')<0){return}var file=value.getAsFile();var reader=new FileReader();E.log('得到一个粘贴图片');reader.onload=function(e){E.log('读取到粘贴的图片');var base64=e.target.result||this.result;editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:fileType,name:uploadFileName})};reader.readAsDataURL(file)})}else{E.log('未从 data.items 得到数据，使用检测粘贴图片的方式');$imgsBeforePaste=$txt.find('img');E.log('粘贴前，检查到编辑器有'+$imgsBeforePaste.length+'个图片');setTimeout(findPasteImgAndUpload,0)}})})});_e(function(E,$){E.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadFileName=config.uploadImgFileName||'wangEditorDragFile';if(!uploadImgUrl){return}E.$document.on('dragleave drop dragenter dragover',function(e){e.preventDefault()});$txt.on('drop',function(dragEvent){dragEvent.preventDefault();var originalEvent=dragEvent.originalEvent;var files=originalEvent.dataTransfer&&originalEvent.dataTransfer.files;if(!files||!files.length){return}$.each(files,function(k,file){var type=file.type;var name=file.name;if(type.indexOf('image/')<0){return}E.log('得到图片 '+name);var reader=new FileReader();reader.onload=function(e){E.log('读取到图片 '+name);var base64=e.target.result||this.result;editor.xhrUploadImg({event:dragEvent,base64:base64,fileType:type,name:uploadFileName})};reader.readAsDataURL(file)})})})});_e(function(E,$){E.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var html='';var $currentTxt=editor.useMaxHeight?$txt.parent():$txt;var $currentTable;var isRendered=false;var $toolbar=$('<div class="txt-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>');var $zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>');var $zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');function render(){if(isRendered){return}bindEvent();$toolbar.append($triangle).append($delete).append($zoomSmall).append($zoomBig);editor.$editorContainer.append($toolbar);isRendered=true}function bindEvent(){var commandFn;function command(e,callback){html=$txt.html();var cb=function(){if(callback){callback()}if(html!==$txt.html()){$txt.change()}};if(commandFn){editor.customCommand(e,commandFn,cb)}}$delete.click(function(e){commandFn=function(){$currentTable.remove()};command(e,function(){setTimeout(hide,100)})});$zoomBig.click(function(e){commandFn=function(){$currentTable.css({width:'100%'})};command(e,function(){setTimeout(show)})});$zoomSmall.click(function(e){commandFn=function(){$currentTable.css({width:'auto'})};command(e,function(){setTimeout(show)})})}function show(){if(editor._disabled){return}if($currentTable==null){return}$currentTable.addClass('clicked');var tablePosition=$currentTable.position();var tableTop=tablePosition.top;var tableLeft=tablePosition.left;var tableHeight=$currentTable.outerHeight();var tableWidth=$currentTable.outerWidth();var top=tableTop+tableHeight;var left=tableLeft;var marginLeft=0;var txtTop=$currentTxt.position().top;var txtHeight=$currentTxt.outerHeight();if(top>(txtTop+txtHeight)){top=txtTop+txtHeight}$toolbar.show();var width=$toolbar.outerWidth();marginLeft=tableWidth/2-width/2;$toolbar.css({top:top+5,left:left,'margin-left':marginLeft});if(marginLeft<0){$toolbar.css('margin-left','0');$triangle.hide()}else{$triangle.show()}}function hide(){if($currentTable==null){return}$currentTable.removeClass('clicked');$currentTable=null;$toolbar.hide()}$currentTxt.on('click','table',function(e){var $table=$(e.currentTarget);render();if($currentTable&&($currentTable.get(0)===$table.get(0))){setTimeout(hide,100);return}$currentTable=$table;show();e.preventDefault();e.stopPropagation()}).on('click keydown scroll',function(e){setTimeout(hide,100)});E.$body.on('click keydown scroll',function(e){setTimeout(hide,100)})})});_e(function(E,$){if(E.userAgent.indexOf('MSIE 8')>0){return}E.plugin(function(){var editor=this;var lang=editor.config.lang;var txt=editor.txt;var $txt=txt.$txt;var html='';var $currentTxt=editor.useMaxHeight?$txt.parent():$txt;var $editorContainer=editor.$editorContainer;var $currentImg;var currentLink='';var isRendered=false;var $dragPoint=$('<div class="img-drag-point"></div>');var $toolbar=$('<div class="txt-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $menuContainer=$('<div></div>');var $delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>');var $zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>');var $zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');var $alignLeft=$('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>');var $alignCenter=$('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>');var $alignRight=$('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>');var $link=$('<a href="#"><i class="wangeditor-menu-img-link"></i></a>');var $unLink=$('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>');var $linkInputContainer=$('<div style="display:none;"></div>');var $linkInput=$('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>');var $linkBtnSubmit=$('<button class="right">'+lang.submit+'</button>');var $linkBtnCancel=$('<button class="right gray">'+lang.cancel+'</button>');var isOnDrag=false;function imgLink(e,url){if(!$currentImg){return}var commandFn;var callback=function(){if(url!=null){currentLink=url}if(html!==$txt.html()){$txt.change()}};var $link;var inLink=false;var $parent=$currentImg.parent();if($parent.get(0).nodeName.toLowerCase()==='a'){$link=$parent;inLink=true}else{$link=$('<a target="_blank"></a>')}if(url==null){return $link.attr('href')||''}else if(url===''){if(inLink){commandFn=function(){$currentImg.unwrap()}}}else{if(url===currentLink){return}commandFn=function(){$link.attr('href',url);if(!inLink){$currentImg.wrap($link)}}}if(commandFn){html=$txt.html();editor.customCommand(e,commandFn,callback)}}function render(){if(isRendered){return}bindToolbarEvent();bindDragEvent();$menuContainer.append($delete).append($zoomSmall).append($zoomBig).append($alignLeft).append($alignCenter).append($alignRight).append($link).append($unLink);$linkInputContainer.append($linkInput).append($linkBtnCancel).append($linkBtnSubmit);$toolbar.append($triangle).append($menuContainer).append($linkInputContainer);editor.$editorContainer.append($toolbar).append($dragPoint);isRendered=true}function bindToolbarEvent(){var commandFn;function customCommand(e,callback){var cb;html=$txt.html();cb=function(){if(callback){callback()}if(html!==$txt.html()){$txt.change()}};if(commandFn){editor.customCommand(e,commandFn,cb)}}$delete.click(function(e){imgLink(e,'');commandFn=function(){$currentImg.remove()};customCommand(e,function(){setTimeout(hide,100)})});$zoomBig.click(function(e){commandFn=function(){var img=$currentImg.get(0);var width=img.width;var height=img.height;width=width*1.1;height=height*1.1;$currentImg.css({width:width+'px',height:height+'px'})};customCommand(e,function(){setTimeout(show)})});$zoomSmall.click(function(e){commandFn=function(){var img=$currentImg.get(0);var width=img.width;var height=img.height;width=width*0.9;height=height*0.9;$currentImg.css({width:width+'px',height:height+'px'})};customCommand(e,function(){setTimeout(show)})});$alignLeft.click(function(e){commandFn=function(){$currentImg.parents('p').css({'text-align':'left'}).attr('align','left')};customCommand(e,function(){setTimeout(hide,100)})});$alignRight.click(function(e){commandFn=function(){$currentImg.parents('p').css({'text-align':'right'}).attr('align','right')};customCommand(e,function(){setTimeout(hide,100)})});$alignCenter.click(function(e){commandFn=function(){$currentImg.parents('p').css({'text-align':'center'}).attr('align','center')};customCommand(e,function(){setTimeout(hide,100)})});$link.click(function(e){e.preventDefault();currentLink=imgLink(e);$linkInput.val(currentLink);$menuContainer.hide();$linkInputContainer.show()});$linkBtnSubmit.click(function(e){e.preventDefault();var url=$.trim($linkInput.val());if(url){imgLink(e,url)}setTimeout(hide)});$linkBtnCancel.click(function(e){e.preventDefault();$linkInput.val(currentLink);$menuContainer.show();$linkInputContainer.hide()});$unLink.click(function(e){e.preventDefault();imgLink(e,'');setTimeout(hide)})}function bindDragEvent(){var _x,_y;var dragMarginLeft,dragMarginTop;var imgWidth,imgHeight;function mousemove(e){var diffX,diffY;diffX=e.pageX-_x;diffY=e.pageY-_y;var currentDragMarginLeft=dragMarginLeft+diffX;var currentDragMarginTop=dragMarginTop+diffY;$dragPoint.css({'margin-left':currentDragMarginLeft,'margin-top':currentDragMarginTop});var currentImgWidth=imgWidth+diffX;var currentImggHeight=imgHeight+diffY;$currentImg&&$currentImg.css({width:currentImgWidth,height:currentImggHeight})}$dragPoint.on('mousedown',function(e){if(!$currentImg){return}_x=e.pageX;_y=e.pageY;dragMarginLeft=parseFloat($dragPoint.css('margin-left'),10);dragMarginTop=parseFloat($dragPoint.css('margin-top'),10);imgWidth=$currentImg.width();imgHeight=$currentImg.height();$toolbar.hide();E.$document.on('mousemove._dragResizeImg',mousemove);E.$document.on('mouseup._dragResizeImg',function(e){E.$document.off('mousemove._dragResizeImg');E.$document.off('mouseup._dragResizeImg');hide();$dragPoint.css({'margin-left':dragMarginLeft,'margin-top':dragMarginTop});isOnDrag=false});isOnDrag=true})}function show(){if(editor._disabled){return}if($currentImg==null){return}$currentImg.addClass('clicked');var imgPosition=$currentImg.position();var imgTop=imgPosition.top;var imgLeft=imgPosition.left;var imgHeight=$currentImg.outerHeight();var imgWidth=$currentImg.outerWidth();$dragPoint.css({top:imgTop+imgHeight,left:imgLeft+imgWidth});var top=imgTop+imgHeight;var left=imgLeft;var marginLeft=0;var txtTop=$currentTxt.position().top;var txtHeight=$currentTxt.outerHeight();if(top>(txtTop+txtHeight)){top=txtTop+txtHeight}else{$dragPoint.show()}$toolbar.show();var width=$toolbar.outerWidth();marginLeft=imgWidth/2-width/2;$toolbar.css({top:top+5,left:left,'margin-left':marginLeft});if(marginLeft<0){$toolbar.css('margin-left','0');$triangle.hide()}else{$triangle.show()}editor.disableMenusExcept()}function hide(){if($currentImg==null){return}$currentImg.removeClass('clicked');$currentImg=null;$toolbar.hide();$dragPoint.hide();editor.enableMenusExcept()}function isEmotion(imgSrc){var result=false;if(!editor.emotionUrls){return result}$.each(editor.emotionUrls,function(index,url){var flag=false;if(imgSrc===url){result=true;flag=true}if(flag){return false;}});return result}$currentTxt.on('mousedown','img',function(e){e.preventDefault()}).on('click','img',function(e){var $img=$(e.currentTarget);var src=$img.attr('src');if(!src||isEmotion(src)){return}render();if($currentImg&&($currentImg.get(0)===$img.get(0))){setTimeout(hide,100);return}$currentImg=$img;show();$menuContainer.show();$linkInputContainer.hide();e.preventDefault();e.stopPropagation()}).on('click keydown scroll',function(e){if(!isOnDrag){setTimeout(hide,100)}})})});_e(function(E,$){E.plugin(function(){var editor=this;var lang=editor.config.lang;var $txt=editor.txt.$txt;var $currentLink;var $toolbar=$('<div class="txt-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $triggerLink=$('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+lang.openLink+'</a>');var isRendered;var isShow=false;var showTimeoutId,hideTimeoutId;var showTimeoutIdByToolbar,hideTimeoutIdByToolbar;function render(){if(isRendered){return}$toolbar.append($triangle).append($triggerLink);editor.$editorContainer.append($toolbar);isRendered=true}function setPosition(){if(!$currentLink){return}var position=$currentLink.position();var left=position.left;var top=position.top;var height=$currentLink.height();var topResult=top+height+5;var menuHeight=editor.menuContainer.height();var txtHeight=editor.txt.$txt.outerHeight();if(topResult>menuHeight+txtHeight){topResult=menuHeight+txtHeight+5}$toolbar.css({top:topResult,left:left})}function show(){if(isShow){return}if(!$currentLink){return}render();$toolbar.show();var href=$currentLink.attr('href');$triggerLink.attr('href',href);setPosition();isShow=true}function hide(){if(!isShow){return}if(!$currentLink){return}$toolbar.hide();isShow=false}$txt.on('mouseenter','a',function(e){if(showTimeoutId){clearTimeout(showTimeoutId)}showTimeoutId=setTimeout(function(){var a=e.currentTarget;var $a=$(a);$currentLink=$a;var $img=$a.children('img');if($img.length){$img.click(function(e){hide()});if($img.hasClass('clicked')){return}}show()},500)}).on('mouseleave','a',function(e){if(hideTimeoutId){clearTimeout(hideTimeoutId)}hideTimeoutId=setTimeout(hide,500)}).on('click keydown scroll',function(e){setTimeout(hide,100)});$toolbar.on('mouseenter',function(e){if(hideTimeoutId){clearTimeout(hideTimeoutId)}}).on('mouseleave',function(e){if(showTimeoutIdByToolbar){clearTimeout(showTimeoutIdByToolbar)}showTimeoutIdByToolbar=setTimeout(hide,500)})})});_e(function(E,$){E.plugin(function(){var editor=this;var menuFixed=editor.config.menuFixed;if(menuFixed===false||typeof menuFixed!=='number'){return}var bodyMarginTop=parseFloat(E.$body.css('margin-top'),10);if(isNaN(bodyMarginTop)){bodyMarginTop=0}var $editorContainer=editor.$editorContainer;var editorTop=$editorContainer.offset().top;var editorHeight=$editorContainer.outerHeight();var $menuContainer=editor.menuContainer.$menuContainer;var menuCssPosition=$menuContainer.css('position');var menuCssTop=$menuContainer.css('top');var menuTop=$menuContainer.offset().top;var menuHeight=$menuContainer.outerHeight();var $txt=editor.txt.$txt;E.$window.scroll(function(){if(editor.isFullScreen){return}var sTop=E.$window.scrollTop();var menuWidth=$menuContainer.width();if(menuTop===0){menuTop=$menuContainer.offset().top;editorTop=$editorContainer.offset().top;editorHeight=$editorContainer.outerHeight();menuHeight=$menuContainer.outerHeight()}if(sTop>=menuTop&&sTop+menuFixed+menuHeight+30<editorTop+editorHeight){$menuContainer.css({position:'fixed',top:menuFixed});$menuContainer.width(menuWidth);E.$body.css({'margin-top':bodyMarginTop+menuHeight});if(!editor._isMenufixed){editor._isMenufixed=true}}else{$menuContainer.css({position:menuCssPosition,top:menuCssTop});$menuContainer.css('width','100%');E.$body.css({'margin-top':bodyMarginTop});if(editor._isMenufixed){editor._isMenufixed=false}}})})});_e(function(E,$){E.createMenu(function(check){var menuId='indent';if(!check(menuId)){return}var editor=this;var menu=new E.Menu({editor:editor,id:menuId,title:'缩进',$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});menu.clickEvent=function(e){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,'p');var $p;if(!p){return e.preventDefault()}$p=$(p);function commandFn(){$p.css('text-indent','2em')}editor.customCommand(e,commandFn)};menu.clickEventSelected=function(e){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,'p');var $p;if(!p){return e.preventDefault()}$p=$(p);function commandFn(){$p.css('text-indent','0')}editor.customCommand(e,commandFn)};menu.updateSelectedEvent=function(){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,'p');var $p;var indent;if(!p){return false}$p=$(p);indent=$p.css('text-indent');if(!indent||indent==='0px'){return false}return true};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId='lineheight';if(!check(menuId)){return}var editor=this;editor.commandHooks.lineHeight=function(value){var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,'p,h1,h2,h3,h4,h5,pre');if(!targetElem){return}$(targetElem).css('line-height',value+'')};var menu=new E.Menu({editor:editor,id:menuId,title:'行高',commandName:'lineHeight',$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')});var data={'1.0':'1.0倍','1.5':'1.5倍','1.8':'1.8倍','2.0':'2.0倍','2.5':'2.5倍','3.0':'3.0倍'};var tpl='<span style="line-height:{#commandValue}">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl });editor.menus[menuId]=menu})});_e(function(E,$){E.plugin(function(){var editor=this;var customUpload=editor.config.customUpload;if(!customUpload){return}else if(editor.config.uploadImgUrl){alert('自定义上传无效，详看浏览器日志console.log');E.error('已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。');return}var $uploadContent=editor.$uploadContent;if(!$uploadContent){E.error('自定义上传，无法获取 editor.$uploadContent')}var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var btnId='upload'+E.random();var containerId='upload'+E.random();$uploadIcon.attr('id',btnId);$uploadContent.attr('id',containerId);editor.customUploadBtnId=btnId;editor.customUploadContainerId=containerId})});_e(function(E,$){E.info('本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ')});return window.wangEditor});